{"id":"001fc5bc-c573-40ef-9db1-07981d23ea89","information":"WODsmith Zod schema testing pattern: When testing Zod schemas, test both successful parse (valid input) and ZodError cases (invalid input). For error cases, catch the ZodError and validate BOTH error.path (which field failed) and error.message (user-facing error message). This ensures validation rules work correctly and return the right error messages. Example pattern: expect(() => schema.parse(input)).toThrow(ZodError) then catch and inspect zodError.errors[0].path and zodError.errors[0].message. Critical for waiver schemas which have specific ID prefix requirements (comp_, team_, waiv_, creg_) and length constraints (title max 255, content max 50000, ipAddress max 45).","created_at":"1766437889002.0"}
{"id":"027a0850-918f-4bbb-9e87-5d7a6b1730c9","information":"WODsmith workout-selection-modal component uses Drawer (Vaul library) which renders with role=\"dialog\" and displays dates using toDateString() format (e.g., \"Sun Jun 15 2025\"), not formatted date strings. Tests should assert on the actual rendered output from toDateString(), not assumed formatted strings. The Drawer component DOES expose role=\"dialog\" correctly, contrary to initial hypothesis.","created_at":"1766273846273.0","tags":"testing,drawer,vaul,date-formatting,accessibility"}
{"id":"02c37b7b-7c5e-4834-904a-4a77e63589ee","information":"## WodSmith Team Context Flow - Detailed Analysis\n\n### Cookie Handling Pattern\n\n**Constants:**\n- Cookie name: `active-team` (from `ACTIVE_TEAM_COOKIE_NAME` in `src/constants.ts`)\n- Session cookie: `session`\n\n**Reading Cookie (src/utils/auth.ts:388-397):**\n```typescript\nexport async function getActiveTeamFromCookie(): Promise<string | null> {\n  const cookieStore = await cookies()\n  const activeTeamCookie = cookieStore.get(ACTIVE_TEAM_COOKIE_NAME)?.value\n  if (!activeTeamCookie) return null\n  return activeTeamCookie\n}\n```\n\n**Writing Cookie (src/utils/auth.ts:403-413):**\n```typescript\nexport async function setActiveTeamCookie(teamId: string): Promise<void> {\n  const cookieStore = await cookies()\n  cookieStore.set(ACTIVE_TEAM_COOKIE_NAME, teamId, {\n    httpOnly: true,\n    sameSite: \"lax\",  // Allows OAuth redirects\n    secure: isProd,    // Only HTTPS in production\n    expires: new Date(Date.now() + getSessionLength()),  // Same as session\n    path: \"/\",         // Available site-wide\n  })\n}\n```\n\n### Team Switcher Flow (src/components/team-switcher.tsx)\n\n1. User selects team from dropdown\n2. Client calls `setActiveTeamAction({ teamId })` via `useServerAction`\n3. Server action validates:\n   - User is authenticated (requireVerifiedEmail)\n   - User has team in session\n   - User has ACCESS_DASHBOARD permission for team\n4. Server action sets cookie via `setActiveTeamCookie(teamId)`\n5. Client calls `router.refresh()` to revalidate all Server Components\n\n### Team Filter on Compete Pages (organizer/_components/team-filter.tsx)\n\n1. Same pattern but also updates URL params:\n   - Sets cookie via `setActiveTeam({ teamId })`\n   - Updates URL with `params.set(\"teamId\", teamId)`\n   - Navigates with `router.push()` (includes URL params)\n\n### Organizer Dashboard Team Resolution (organizer/(dashboard)/page.tsx)\n\nPriority order for activeTeamId:\n1. URL searchParam `?teamId=xxx` (highest priority)\n2. Cookie value IF it's a valid organizing team\n3. First organizing team (fallback)\n\n```typescript\nlet activeTeamId: string | undefined = selectedTeamId  // URL param\nif (!activeTeamId && activeTeamFromCookie) {\n  if (organizingTeams.some((t) => t.id === activeTeamFromCookie)) {\n    activeTeamId = activeTeamFromCookie  // Cookie if valid\n  }\n}\nif (!activeTeamId && organizingTeams.length > 0) {\n  activeTeamId = organizingTeams[0]?.id  // First team fallback\n}\n```\n\n### Competition Loading with Team Filtering\n\n**getCompetitions (src/server/competitions.ts:627-655):**\n```typescript\nexport async function getCompetitions(teamId: string) {\n  const db = getDb()\n  return db.query.competitionsTable.findMany({\n    where: eq(competitionsTable.organizingTeamId, teamId),\n    with: { competitionTeam: true, group: true, organizingTeam: true },\n    orderBy: (table, { desc }) => [desc(table.startDate)],\n  })\n}\n```\n\nKey: Filters by `organizingTeamId`, NOT `competitionTeamId`.\n\n### getUserOrganizingTeams (src/utils/get-user-organizing-teams.ts)\n\nReturns teams where user has:\n1. `MANAGE_PROGRAMMING` permission AND\n2. Team has `HOST_COMPETITIONS` feature enabled (entitlement check)\n\nUses `cache()` from React for request deduplication.\n\n### Full Data Flow Summary\n\nUser clicks team → setActiveTeamAction → validates membership + permissions\n→ setActiveTeamCookie (httpOnly, lax, secure in prod)\n→ router.refresh() OR router.push() with URL params\n→ Server re-renders page\n→ getActiveTeamFromCookie() reads cookie\n→ Validates against organizing teams (entitlements check)\n→ getCompetitions(activeTeamId) queries by organizingTeamId\n→ UI displays filtered competitions\n\n### Key Differences: Main Switcher vs Team Filter\n\n| Component | Cookie Update | URL Update | Navigation |\n|-----------|--------------|------------|------------|\n| TeamSwitcher | Yes | No | router.refresh() |\n| TeamFilter | Yes | Yes (?teamId=) | router.push() |\n\nThe TeamFilter on compete pages uses BOTH cookie AND URL params for state, with URL taking priority. This is important for the TanStack Start port.","created_at":"1767208680643.0"}
{"id":"04b9d92c-c458-4ac5-acda-d05623184045","information":"TanStack Start component discovery pattern: When auditing migration docs, always glob for actual components on disk. WODsmith TanStack migration had 4 undocumented components (programming-track-edit-dialog, programming-track-delete-dialog, track-visibility-selector, team-controls). Impact: Doc understated migration completeness - all CRUD operations have UI components, not just partial coverage.","created_at":"1766530545640.0"}
{"id":"04c53ff7-6a25-479e-9f70-d41f3ba22203","information":"## Alchemy Local Development with Cloudflare Bindings - Full Reference\n\n### Vite Plugin Configuration (TanStack Start)\n\nThe Alchemy Vite plugin replaces the older `cloudflareWorkersDevEnvironmentShim` with a unified `alchemy()` plugin:\n\n```typescript\n// vite.config.ts\nimport { tanstackStart } from \"@tanstack/react-start/plugin/vite\";\nimport viteReact from \"@vitejs/plugin-react\";\nimport alchemy from \"alchemy/cloudflare/tanstack-start\"; // framework-specific import\nimport { defineConfig } from \"vite\";\nimport tsConfigPaths from \"vite-tsconfig-paths\";\n\nexport default defineConfig({\n  build: {\n    target: \"esnext\",\n    rollupOptions: {\n      external: [\"node:async_hooks\", \"cloudflare:workers\"],\n    },\n  },\n  plugins: [\n    alchemy(), // MUST be first\n    tsConfigPaths({ projects: [\"./tsconfig.json\"] }),\n    tanstackStart({\n      target: \"cloudflare-module\", // Required for Cloudflare Workers\n      customViteReactPlugin: true,\n    }),\n    viteReact(),\n  ],\n});\n```\n\nFramework-specific Vite plugins:\n- `alchemy/cloudflare/tanstack-start` - TanStack Start\n- `alchemy/cloudflare/react-router` - React Router v7\n- `alchemy/cloudflare` - Generic Workers\n\n### Development Commands\n\n```bash\n# Run Alchemy dev mode (hot reloading, local simulation)\nbun alchemy dev\nnpx alchemy dev\npnpm alchemy dev\n\n# Alternative: direct execution with watch mode\nbun --watch ./alchemy.run.ts --dev\n\n# Options:\n# --stage <name>    - Stage/environment (default: $USER)\n# --env-file <path> - Load env vars from file\n# --force           - Force update all resources\n# --adopt           - Adopt unmanaged resources\n```\n\n### Binding Emulation in Dev Mode\n\nAlchemy emulates all Cloudflare bindings locally during `alchemy dev`:\n\n```typescript\n// alchemy.run.ts\nimport { TanStackStart, D1Database, KVNamespace, R2Bucket, Queue } from \"alchemy/cloudflare\";\n\nconst d1 = await D1Database(\"my-d1\", { name: \"my-db\" });\nconst kv = await KVNamespace(\"my-kv\", { title: \"my-kv-namespace\" });\nconst r2 = await R2Bucket(\"my-r2\", { name: \"my-bucket\" });\nconst queue = await Queue(\"my-queue\");\n\nconst app = await TanStackStart(\"my-app\", {\n  bindings: {\n    DB: d1,\n    KV: kv,\n    R2: r2,\n    QUEUE: queue,\n    STAGE: \"dev\",\n    API_KEY: alchemy.secret(\"my-secret\"),\n  },\n});\n```\n\n### Remote D1 in Dev Mode\n\nUse real Cloudflare D1 during development instead of local emulation:\n\n```typescript\nconst db = await D1Database(\"app-db\", {\n  dev: { remote: true } // Connects to actual Cloudflare D1\n});\n```\n\n### State Persistence\n\nAlchemy stores infrastructure state in `.alchemy/` directory:\n- Location: `.alchemy/{app-name}/{stage}/`\n- Format: JSON files per resource\n- Structure includes provider, data, status, output, and props fields\n\nCustom state directory:\n```typescript\nimport { FileSystemStateStore } from \"alchemy\";\nimport path from \"path\";\n\nconst app = await alchemy(\"my-app\", {\n  stateStore: (scope) => new FileSystemStateStore(scope, {\n    rootDir: path.resolve(import.meta.dir, \"..\", \".alchemy\")\n  })\n});\n```\n\n### Environment Variables\n\nRequired `.env` file:\n```dotenv\nALCHEMY_PASSWORD=your-secure-encryption-password\n```\n\nThe `ALCHEMY_PASSWORD` is used to encrypt secrets in state files. Never commit `.env` to source control.\n\n### Type-Safe Bindings\n\nOption 1: Import types from alchemy.run.ts\n```typescript\nimport type { worker } from \"../alchemy.run.ts\";\n\nexport default {\n  async fetch(request: Request, env: typeof worker.Env, ctx: any) {\n    const value = await env.DB.prepare(\"SELECT * FROM users\").all();\n    return Response.json(value);\n  }\n};\n```\n\nOption 2: Global type augmentation via types/env.d.ts, register in tsconfig.json with @cloudflare/workers-types\n\n### D1 Migrations with Drizzle\n\n```typescript\nimport { D1Database } from \"alchemy/cloudflare\";\n\nconst db = await D1Database(\"my-db\", {\n  name: \"my-db\",\n  migrationsDir: \"./migrations\",\n  migrationsTable: \"drizzle_migrations\", // Drizzle compatibility\n});\n```\n\n### Key Differences from Wrangler\n\n1. **No wrangler.toml/jsonc** - Infrastructure defined in TypeScript\n2. **State tracked** - `.alchemy/` directory vs Cloudflare dashboard\n3. **Type-safe bindings** - Inferred from alchemy.run.ts\n4. **Unified dev experience** - Same bindings work locally and in production\n5. **Secret encryption** - Secrets encrypted in state, not stored in separate files","created_at":"1767044099572.0"}
{"id":"062f8cbf-a7e7-4a87-9286-e6af9df3ef26","information":"TanStack Start virtual module resolution with Alchemy and Cloudflare: The error \"Failed to resolve import tanstack-start-injected-head-scripts:v\" can occur when using older versions of @tanstack/react-start with @cloudflare/vite-plugin via Alchemy. Solution: Upgrade TanStack Start packages to latest versions (tested working: @tanstack/react-start@1.145.3, @tanstack/react-router@1.144.0, @tanstack/router-plugin@1.145.2). The virtual module is registered by TanStack's dev-server-plugin and only applies to server environments. The Alchemy plugin must remain first in the Vite plugins array to handle Cloudflare bindings correctly. Version mismatches between TanStack packages can cause module resolution failures.","created_at":"1767198123852.0"}
{"id":"074c78de-b0dd-4068-8ed6-223b2d869e75","information":"Documentation anti-pattern from Competition Corner analysis: One-sentence articles that answer WHAT but not HOW. Example: \"Adding Supplemental Fees\" article is literally one sentence: \"Supplemental Fees allows you to add any additional fee as a line item to your registration fees, such as Sales Tax, Environmental Fees, etc.\" Missing: UI walkthrough showing HOW to add them, examples of when to use, tax calculation guidance. RULE: Every documentation article must answer WHAT + WHY + HOW with concrete examples. If you can't fill a meaningful article, merge it into a larger topic or expand with workflows/screenshots/examples.","created_at":"1766354333297.0","metadata":"{\"source\":\"Competition Corner analysis\",\"project\":\"competition-platform\"}","tags":"documentation,anti-pattern,content-depth,help-center"}
{"id":"09a09cec-d53b-42df-86bc-d308382e5d6f","information":"WODsmith judge rotation enrichment pattern: Created getEnrichedRotationsForJudge() server function that uses autochunk from batch-query.ts for all inArray queries to respect D1's 100-param limit. Pattern: 1) fetch base data, 2) extract unique IDs, 3) batch-fetch with autochunk for trackWorkouts/workouts/heats, 4) use existing getWorkoutDivisionDescriptions (already uses autochunk), 5) calculate derived fields (timeWindow, estimatedDuration, isUpcoming), 6) filter unpublished events. Returns enriched rotations ready for UI with no N+1 queries.","created_at":"1766163064845.0"}
{"id":"0eedcf50-b25f-4278-aaa6-5922b4c5e7fe","information":"Judge rotation migration strategy for WODsmith:\n1. Query existing per-heat assignments with heat details via relations\n2. Group by (membershipId, trackWorkoutId) to identify judge-event pairs\n3. Sort by heatNumber to detect consecutive sequences\n4. Create rotation records with startingHeat, heatsCount, startingLane\n5. Link assignments back via rotationId FK for traceability\n6. Flag non-consecutive sequences as ambiguous for manual review\n7. Default laneShiftPattern to \"stay\" when migrating existing data\nThe rotationId FK enables backward compatibility - old assignments continue working while new rotations create linked assignments.","created_at":"1765995247676.0"}
{"id":"12c38f8b-83fd-4faf-acb8-20bd218c0bc9","information":"WODsmith uses two patterns for seed scripts:\n1. TypeScript scripts (apps/wodsmith/scripts/seed-*.ts) for local development using wrangler's unstable_dev API\n2. SQL scripts (apps/wodsmith/scripts/seed-*.sql) for production using wrangler d1 execute\n\nTypeScript seed pattern:\n- Import drizzle from \"drizzle-orm/d1\"\n- Import tables from \"../src/db/schema\"\n- Use getD1Database() helper with unstable_dev\n- Use .onConflictDoNothing() for idempotency\n- Follow try/catch with console logging\n\nEntitlement types table has: id, name, description (plus commonColumns)\nNote: The schema does NOT have a category field on entitlement_type - category is only on feature table","created_at":"1765950484658.0"}
{"id":"157b14f9-cdea-4d2c-a928-9c09286066a0","information":"WODsmith volunteer profile self-service pattern: Created volunteer profile card with edit dialog that allows volunteers to update their own availability, credentials, and notes. Key implementation details: (1) updateVolunteerProfileAction verifies membership.userId === session.userId for self-service updates, (2) VolunteerProfileCard is collapsible with always-visible availability badge, (3) EditVolunteerDialog uses native radio inputs (not Shadcn RadioGroup) following existing volunteer form patterns, (4) Action merges partial updates with spread operator to preserve existing metadata fields, (5) Uses muted color scheme (bg-muted/30, border-muted) to not compete with main schedule content. Pattern works for any team membership metadata that users should self-manage.","created_at":"1766188905173.0"}
{"id":"15c1f36e-cde5-4241-a6fa-41fd5af7fb25","information":"TanStack Start migration from Next.js for competition schedule components: Pattern for porting useServerAction + useToast to callback-based architecture. Key learnings:\n1. Replace `useServerAction` with callback props (onAssignAthlete, onRemoveAthlete, etc.) that return Promises\n2. Replace `useToast()` hook with direct `import {toast} from 'sonner'` since sonner is available in wodsmith-start\n3. State management for async operations (isAssigning, removingId) done locally with useState instead of server action pending states\n4. Drag-drop pattern with refs for volatile state (closestEdgeRef) and useCallback wrapper (updateClosestEdge) works identically in TanStack Start\n5. Import paths use @/ convention (not ~/)","created_at":"1766699328601.0"}
{"id":"1713374d-a4f3-4385-a7cf-06ed25d33e95","information":"WODsmith volunteer schedule pattern: Created /my-schedule route for volunteers to view judge assignments. Server component fetches rotations with getRotationsForJudge(), then enriches with workout name and heat time windows by querying trackWorkoutsTable, workouts, and competitionHeatsTable separately. Client components receive enriched data as props. Time window calculated from startHeat.scheduledTime to endHeat.scheduledTime + durationMinutes. Lane pattern formatted based on LANE_SHIFT_PATTERN (stay/shift_right/shift_left).","created_at":"1765992637938.0"}
{"id":"1747e975-85da-4239-bcfd-0a2d4891af07","information":"TanStack Start auth migration test coverage audit completed. Key findings: 8 E2E tests exist in e2e/auth.spec.ts covering sign-in flows (login, logout, session persistence, error handling), but ZERO integration tests exist for any of the 10 auth actions (signInAction, signUpAction, forgotPasswordAction, resetPasswordAction, verifyEmailAction, resendVerificationAction, googleSSOCallbackAction, acceptTeamInviteAction, startPasskeyRegistrationAction, completePasskeyRegistrationAction). ZERO unit tests exist for auth utilities (hashPassword, verifyPassword, canSignUp, token generation). Testing Trophy strategy: E2E for P0 critical paths (sign-in done), Integration for P1/P2 actions (all missing - BLOCKER), Unit for validators/utilities (all missing). Test files should go in apps/wodsmith/test/actions/ for integration tests, apps/wodsmith/test/utils/ for unit tests. Mocking pattern: vi.mock() for @/utils/auth, @/utils/team-auth already established in other test files.","created_at":"1766641639952.0"}
{"id":"1af6ef04-bd33-452a-bfbb-8f5ce3c5a5fd","information":"WODsmith testing infrastructure current state (Dec 2025): Vitest 3.2.3 with 43 test files, basic chainable D1 mock in setup.ts, NO workspace config, NO test-utils package, NO Playwright config despite playwright@1.55.0 installed, NO CI test pipeline. Ad-hoc factory pattern exists in 2 files (volunteers.test.ts, judge-rotation-utils.test.ts) but not formalized. Testing gap vs Gremlin pattern: missing Phase 1 (test-utils package with FakeDatabase, factories), Phase 2 (workspace config), Phase 3 (Playwright setup), Phase 4 (CI/CD). Mocking pattern: chainable mock with vi.fn() returning itself for query chains. Key seams: auth (requireVerifiedEmail), DB (getDb), permissions (hasTeamPermission). Test organization: lib/ for pure functions, server/ for services, actions/ for server actions, components/ for React components.","created_at":"1766211175097.0"}
{"id":"1b418f4f-01ae-4aa8-8b4c-87085c8f1da2","information":"WODsmith organizer request approval reviewer display bug: Root cause was the OrganizerRequestsTable component manually merging server action responses into local state after approve/reject operations. The merge only copied raw DB fields (status, reviewedAt, reviewedBy, adminNotes) but NOT the enriched `reviewer` object (which has id, firstName, lastName). The `getAllOrganizerRequests` function does a separate query to fetch reviewer user details and attaches them as a `reviewer` object. Fix: Use `router.refresh()` instead of manual state merge, which refetches complete server data including the enriched reviewer object. This simplified the component by removing unnecessary useState for requests.","created_at":"1767033994584.0"}
{"id":"1b4502e8-f61c-4cea-978d-799d7f452ad8","information":"WODsmith EventDefaultsEditor heat buffer UI: Successfully added minHeatBuffer field to EventDefaultsEditor component following the exact pattern used for defaultHeatsCount. Key pattern: (1) Add field to EventDefaultsEditorProps interface, (2) Add local state with useRef for debouncing (e.g., localBuffer, bufferDebounceRef), (3) Create effectiveBuffer with fallback (minHeatBuffer ?? 2), (4) Add useEffect to sync local state when props change, (5) Create save function (saveBuffer) calling updateEventDefaultsAction with single field, (6) Create handler (handleBufferChange) with validation, local state update, and debounced save (DEBOUNCE_MS = 500), (7) Add cleanup in useEffect return, (8) Add UI section with Label, Input (type=\"number\", min/max), Loader2 spinner when isSubmitting, and helper text. Also updated: UpdateEventRotationDefaultsParams type, updateEventDefaultsSchema zod schema (z.number().int().min(1).max(10).nullable().optional()), updateEventRotationDefaults function updateData object, getRotationsForEvent return type and query, and parent component to pass minHeatBuffer prop. The pattern is highly consistent - always debounce numeric inputs, show loading state, provide helper text explaining current state (event override vs default).","created_at":"1766094489552.0"}
{"id":"1ba74e6a-0835-440b-9822-d4c3d6eebbab","information":"WODsmith Drizzle Relation Type Errors - Recurring Pattern (June 2025):\n\nROOT CAUSE: Drizzle's `with: { relation: true }` clause loads relations at runtime but TypeScript doesn't infer the relation properties in the return type. This causes errors like:\n- \"Property 'workout' does not exist on type '{ id: string; trackId: string; ... }'\"\n- \"Property 'track' does not exist... Did you mean 'trackId'?\"\n- \"Property 'competition' does not exist\"\n- \"Property 'organizingTeam' does not exist\"\n\nAFFECTED FILES (historically): competition-scores.ts, competition-workouts.ts, programming.ts, judge-assignments.ts, judge-scheduling.ts, purchases.ts, auth.ts\n\nTHREE FIX STRATEGIES:\n1. Type Alias Cast: `type XWithY = X & { y: Y }` then cast result `as XWithY`\n2. Explicit Join: Use `.select().from().innerJoin()` for full type inference\n3. Type Guard: `if ('workout' in result && result.workout)` for optional relations\n\nPREVENTION: When writing `db.query.table.findFirst({ with: { relation: true } })`, ALWAYS either:\n- Create a type alias for the result\n- Or use explicit join instead\n\nThis pattern has caused 60+ type errors in a single session. The type-safety skill (.claude/skills/type-safety/) documents the fix patterns.","created_at":"1766094139762.0"}
{"id":"1dcc98a1-1d59-4f30-bb10-1680c42c8c13","information":"Competition Corner help center documentation patterns for fees/payouts/refunds: STRENGTHS - (1) Concrete examples with exact math (e.g., \"charge $50, absorb fees → net $44.25\"), (2) Visual walkthroughs using animated GIFs and annotated screenshots, (3) Embedded FAQs answering follow-up questions inline, (4) Cross-linking between related articles to prevent dead-ends, (5) External authority links to Stripe docs to offload maintenance. GAPS - (1) Minimal content in some articles (one-sentence \"Supplemental Fees\"), (2) Zero tax guidance despite 22+ currencies, (3) No payout timing details, (4) No chargeback/dispute handling, (5) No financial reporting/accounting docs, (6) No batch refund operations, (7) Missing troubleshooting for common errors. KEY INSIGHT: Show concrete math and visual walkthroughs, but go MUCH deeper on tax, compliance, troubleshooting, and financial operations for international platform. 13 articles is foundational but needs 15-20 high-quality articles to cover edge cases and financial literacy gaps.","created_at":"1766354328945.0","metadata":"{\"source\":\"Competition Corner analysis\",\"project\":\"competition-platform\"}","tags":"documentation,competitor-analysis,help-center,fees,payouts,refunds,patterns"}
{"id":"2184c023-118a-4b36-9f48-66c2c3d90595","information":"WODsmith feature gaps analysis patterns: Synthesized from 4 transcript sources (Basile demo, Jon demo, demo prep, scoring meeting). Gap matrix format with Status/Source/Priority columns proved effective. Key insight: volunteer/judge management is the highest-leverage MVP opportunity - Competition Corner doesn't touch it at all. Pricing comparison shows WODsmith is most competitive (2.5%+$2 vs CC 4%+$2 vs Conquest $5.50 flat). Progressive enhancement principle from Basile: \"nothing required, more data = more helpful\" applies to judge credentials/shifts. Heat-level granularity is sweet spot (not lane-level). Cross-referencing codebase inventory against transcript requests revealed 16 gaps across Missing/Partial/Exists categories.","created_at":"1766163762025.0"}
{"id":"21dc9641-dc5e-4317-ae0f-21c008b55982","information":"Competition Corner on-site documentation pattern analysis: 90-article collection shows task-oriented structure with question-based titles (\"How do I...?\"). Strong on feature explanation (HOW), weak on workflow guidance (WHEN/WHY). Key insight: most articles got 403s but collection page structure + article titles are highly descriptive - you can analyze documentation patterns from meta-structure alone. Visual content (GIFs for check-in flow, photos for Smart TV setup) critical for on-site operational docs. Major gap: no timeline-based guides (30 days before, 1 week before, event day). Opportunity: offline capability docs missing despite being critical for venue-based events with poor connectivity.","created_at":"1766354321819.0","tags":"competition-corner,documentation-analysis,help-center-patterns,on-site-events,workflow-design"}
{"id":"224d2d51-b83e-498e-8c8f-7e2385005d48","information":"TanStack Start component migration pattern for WODsmith: 1) Use @/ import alias not ~/ (vitest.config.ts has alias \"@\" → \"./src\"). 2) CompetitionWorkout type scoreType uses \"min\"|\"max\"|\"sum\"|\"average\"|\"first\"|\"last\" not scheme names like \"time\". 3) heatStatus/eventStatus are \"draft\"|\"published\"|null not \"not_started\". 4) Test factories should use correct DB schema types. 5) For multiline text assertions in tests, use regex matchers rather than exact string match.","created_at":"1766698822595.0"}
{"id":"224ed260-c8f1-446b-9647-b0561b668dd7","information":"TanStack Start with @cloudflare/vite-plugin: Route files that import from @/db (which uses cloudflare:workers internally) cause \"Cannot resolve cloudflare:workers\" errors because Vite bundles ALL top-level imports for both client and server bundles. Fix: Move server functions to separate files in src/server-fns/ and import only the server function from route files. Server function files can import from @/db safely because TanStack Start's createServerFn marks the handler as server-only. Route files should use `import type` for any schema types needed for client-side validation.","created_at":"1766703537936.0","tags":"tanstack-start,cloudflare,vite,server-functions,import-error"}
{"id":"22bf267d-0763-4142-ae41-6f2c772b7c73","information":"WODsmith CI/CD baseline assessment: No CI testing workflows exist. Only deploy.yml (deploys to Cloudflare on main push) and git-town.yml (PR decoration). No test/lint/typecheck gates before deployment. TURBO_TOKEN/TURBO_TEAM not configured. Turbo.json has test task defined but missing inputs/outputs specification. 43 Vitest test files exist but run only via manual `pnpm test`. Playwright installed but no e2e directory or config exists. Testing plan proposes ci.yaml with parallel jobs (build, test, typecheck, lint) and e2e.yaml with sharding - all viable but requires TURBO_TOKEN setup for remote caching and test input/output config in turbo.json.","created_at":"1766211155152.0"}
{"id":"2656a709-c23a-44cb-b8e9-a720c6b034f0","information":"Created sponsor test factories for WODsmith test-utils. Factory pattern: use createId() with proper prefixes (spgrp_, spnsr_), Date objects for timestamps, updateCounter=null, spread overrides last. Sponsor supports competitionId or userId. SponsorGroup requires competitionId. Export both factory function and interface type from index.ts. Verify with: pnpm type-check --filter @repo/test-utils","created_at":"1766615935297.0"}
{"id":"265e52dd-7f46-44d9-a4d9-a51875e0dafa","information":"TanStack Start virtual module resolution error with Alchemy/Cloudflare: The error `Failed to resolve import \"tanstack-start-injected-head-scripts:v\"` occurs when TanStack Start packages are outdated relative to Alchemy and @cloudflare/vite-plugin. The virtual module is registered by TanStack's dev-server-plugin but only applies to server environments. Version mismatches can cause the resolver to not be properly registered. FIX: Upgrade TanStack packages to 1.145.x or later when using with Alchemy. Required packages: @tanstack/react-start >= 1.145.0, @tanstack/react-router >= 1.144.0, @tanstack/router-plugin >= 1.145.0. Keep all TanStack packages in sync. Alchemy plugin MUST remain first in Vite plugins array.","created_at":"1767198241023.0"}
{"id":"26e0ed9a-aacc-42da-a4ec-731cc18d6ac3","information":"TanStack Start inline auth forms - router invalidation after sign-in:\n\nPROBLEM: After successful sign-in via inline auth forms (on pages like /compete/organizer/onboard), the page doesn't update to show authenticated UI because the route loader isn't re-run.\n\nWRONG APPROACH: Using `window.location.href` for full page reload works but provides poor UX (flash of content, loses client state).\n\nCORRECT APPROACH: Use `useRouter` hook and call `router.invalidate()` after successful authentication:\n\n```tsx\nimport { useRouter } from \"@tanstack/react-router\"\n\nfunction SignInForm() {\n  const router = useRouter()\n  \n  const onSubmit = async (data) => {\n    const result = await signIn({ data })\n    // After successful sign-in, invalidate router to re-run loader\n    await router.invalidate()\n  }\n}\n```\n\nThis re-runs the route loader which checks session and returns fresh `isAuthenticated` state, causing the component to re-render and show the correct UI (e.g., OrganizerRequestForm instead of AuthSection).\n\nPattern applies to: Any TanStack Start page with inline auth that conditionally renders based on loader data from session state.","created_at":"1767223648156.0"}
{"id":"2810e77f-b68d-4bcc-be3e-e64034ad735f","information":"TanStack Start dark mode flash prevention pattern: 1) Inject blocking inline script in shellComponent's head BEFORE HeadContent - reads localStorage/cookie and adds .dark class to documentElement synchronously. 2) For SSR match, use createMiddleware().server() with getCookie('theme') to pass theme to server context. 3) Control html attributes via shellComponent in createRootRoute(). 4) No built-in dark mode - must wire manually. Key: script must be blocking (no async/defer) and run before first paint.","created_at":"1767136313386.0"}
{"id":"293ca328-8f60-409f-acd0-4023d2d80874","information":"TanStack Start heat-schedule-manager migration pattern: The Next.js version (46KB, 1516 lines) uses server actions via useServerAction for all CRUD operations. For TanStack Start, convert to callback props pattern: onCreateHeat, onDeleteHeat, onHeatStatusChange, onReorderHeats, onCopyHeatsFromEvent, onGetEventsWithHeats. The component now requires additional props: organizingTeamId, competitionStartDate, divisions, registrations. Key features that needed full reimplementation: DraggableDivisionHeader for drag-drop, multi-select athletes with shift+click, heat calculation, bulk create, copy heats from events, heat reordering. Toast notifications use 'sonner' directly instead of useToast hook. All 128 organizer tests pass.","created_at":"1766700144981.0"}
{"id":"2954f037-a85b-40e1-a412-e1596d02dab7","information":"TanStack Start team context cookie pattern implemented in WodSmith Start:\n\n**Key Pattern:**\n- `getActiveTeamId()` in team-auth.ts uses dynamic imports for `getCookie` to avoid bundling server code into client\n- Server function wrapper `getActiveTeamIdFn` in team-fns.ts for use in route loaders\n- Route loaders call the server function, not the utility directly\n\n**Implementation:**\n```typescript\n// team-auth.ts - uses dynamic imports\nexport async function getActiveTeamId(): Promise<string | null> {\n  const { getCookie } = await import(\"@tanstack/react-start/server\")\n  const { ACTIVE_TEAM_COOKIE_NAME } = await import(\"@/constants\")\n  const session = await getSessionFromCookie()\n  \n  if (!session?.teams?.length) return null\n  \n  const cookieTeamId = getCookie(ACTIVE_TEAM_COOKIE_NAME)\n  if (cookieTeamId && session.teams.some(t => t.id === cookieTeamId)) {\n    return cookieTeamId\n  }\n  return session.teams[0]?.id ?? null\n}\n\n// team-fns.ts - server function wrapper\nexport const getActiveTeamIdFn = createServerFn({ method: \"GET\" }).handler(\n  async () => {\n    const { getActiveTeamId } = await import(\"@/utils/team-auth\")\n    return getActiveTeamId()\n  },\n)\n\n// route loader\nloader: async ({ context }) => {\n  const activeTeamId = await getActiveTeamIdFn()\n  // ... use activeTeamId\n}\n```\n\n**Priority order for team resolution:**\n1. Cookie value (if user is member of that team)\n2. First team in session (fallback)\n3. null (if no teams)\n\nHandles stale cookies gracefully - if cookie contains team ID user is no longer member of, falls back to first team.","created_at":"1767209603050.0"}
{"id":"2ba172aa-0f70-473d-b29d-962f572c14d4","information":"Judge scheduling server functions for WODsmith follow the same patterns as athlete heat scheduling (competition-heats.ts): \n1. Use autochunk from @/utils/batch-query for all inArray queries with dynamic arrays to respect D1's 100 param limit\n2. Pass db as parameter (DrizzleD1Database type), don't import getDb()\n3. Batch inserts with manual chunk() + Promise.all for bulk operations (max 10 rows per batch)\n4. Parse JSON metadata with try-catch, return null on error\n5. Build maps for related data (users, memberships) after batched fetches\n6. For time conflict checks, compare overlapping time ranges: (start1 < end2) AND (end1 > start2)\n7. Use manual array filtering when complex SQL would be needed (e.g., filtering by heatNumber after fetching all heats)\n8. Always return typed interfaces, not raw table rows\n9. Throw descriptive errors when operations fail (\"Failed to assign judge to heat\")\n10. For bulk copy operations (judges work multiple heats), use bulkAssignJudgesToHeat helper to avoid duplication","created_at":"1765950823380.0"}
{"id":"2cd234d3-a71d-4d7a-8f49-fcfa6a230966","information":"Test utilities pattern for WODsmith: Created spy helpers (createSpy, createAsyncSpy, createRejectingSpy), delay helpers (delay, flushPromises), and tenant isolation helpers (createTenantContext, generateTeamIds) in packages/test-utils/src/helpers/. Also created tenant assertion helpers (assertTenantIsolation, assertRecordIsolation, assertAllBelongToTeam) in packages/test-utils/src/assertions/. CRITICAL TypeScript fix: When creating test schema interfaces for FakeDatabase<T>, must extend Record<string, Record<string, unknown>> to satisfy generic constraint (e.g., \"interface TestSchema extends Record<string, Record<string, unknown>>\"). Without this, TypeScript throws \"Index signature for type 'string' is missing\" error. All helpers have comprehensive JSDoc with examples for discoverability.","created_at":"1766266442223.0"}
{"id":"2d19bf41-7b20-42c9-bf6c-656e50b7de7e","information":"WODsmith waiver schema test coverage: Comprehensive Zod schema tests for 6 schemas (createWaiverSchema, updateWaiverSchema, deleteWaiverSchema, reorderWaiversSchema, signWaiverSchema, getWaiverSignaturesForRegistrationSchema). Test pattern: valid inputs (with defaults, boundary values like max 255 chars title, max 50000 chars content), invalid inputs (missing fields, wrong prefixes like comp_, team_, waiv_, creg_, empty strings, exceeding limits, wrong types), edge cases (empty arrays, negative positions, IPv6 addresses). Total 45 tests covering all validation rules. Key: Test both success=true AND error messages for failures. Use safeParse() for graceful error handling.","created_at":"1766440955107.0"}
{"id":"2dd5160a-075d-47aa-8282-aaa30a25bdad","information":"Drizzle Kit's interactive prompts (for table create/rename decisions) don't respond to stdin piping or expect scripts with standard escape sequences. When drizzle-kit generate prompts for table creation vs rename: 1. The TUI uses a library that doesn't read from stdin 2. Escape sequences don't work 3. Best approach: Manually create SQL migration files following existing migration patterns 4. Update _journal.json with new entry 5. For table renames use ALTER TABLE old_name RENAME TO new_name 6. Drop old indexes and create new ones with updated names 7. This is acceptable per project guidelines - migrations are in git and reviewed","created_at":"1766013345499.0"}
{"id":"2fa18a0a-749a-402d-b4c4-be471342eeaf","information":"TanStack Start Observability Guide (fetched 2024-12-30):\n\n## Initialization Pattern\n- Client-side: Initialize in `app.tsx` using `import.meta.env.VITE_*` for env vars\n- Server-side: Use `@sentry/node` (or equivalent) directly in server function handlers\n- No special instrumentation.ts file pattern like Next.js - initialization happens at module level\n\n## Client-Side Setup (Sentry example, applies to PostHog):\n```tsx\n// Client-side (app.tsx)\nimport * as Sentry from '@sentry/react'\nSentry.init({\n  dsn: import.meta.env.VITE_SENTRY_DSN,\n  environment: import.meta.env.NODE_ENV,\n})\n```\n\n## Server-Side Pattern:\n- Wrap server functions with try/catch and capture exceptions\n- Use `createMiddleware().server()` for request/response logging\n- Middleware pattern: `async ({ request, next }) => {...}`\n\n## Route Performance Monitoring:\n- Add timing in route `loader` functions\n- Check `typeof window === 'undefined'` to detect SSR vs client\n- Use `React.useEffect()` for client-side render timing\n- Use `performance.now()` for client metrics\n\n## Middleware Pattern for All Requests:\n```tsx\nconst requestLogger = createMiddleware().server(async ({ request, next }) => {\n  const startTime = Date.now()\n  const result = await next()\n  const duration = Date.now() - startTime\n  console.log(`${request.method} ${request.url} - ${result.response.status} (${duration}ms)`)\n  return result\n})\n```\n\n## Health Check Endpoints:\n- Create via `createFileRoute('/health')` with `server.handlers.GET`\n- Return JSON with status, uptime, memory, database checks\n\n## Error Boundaries:\n- Use `react-error-boundary` ErrorBoundary component on client\n- Server functions: wrap in try/catch, log context, throw user-friendly errors\n\n## Key Differences from Next.js:\n1. No `instrumentation.ts` file - init at module level in app.tsx\n2. Env vars use `import.meta.env.VITE_*` (Vite convention) not `process.env`\n3. Server functions use `createServerFn().handler()` pattern\n4. Middleware uses `createMiddleware().server()` not Next.js middleware.ts\n5. Route handlers defined via `server.handlers` in route files\n\n## PostHog-Specific Notes:\n- Guide doesn't mention PostHog specifically (Sentry is partner)\n- Same pattern applies: init posthog in app.tsx for client\n- Use posthog-node for server-side tracking in server functions\n- Route change tracking: use TanStack Router's navigation events or useEffect in layout","created_at":"1767135176375.0"}
{"id":"316faf0c-2f26-4f97-b6a2-02fbed114b47","information":"WODsmith TanStack migration has 19 total routes to migrate (7 settings, 12 admin). Current progress is ~10% with only programming routes partially migrated. Key priorities: 1) Settings routes (profile, security/passkeys, teams) are high priority for core user features. 2) Admin scheduling route is the primary admin feature using FullCalendar - complex migration. 3) Programming routes already partially migrated to /settings/programming in TanStack. 4) Admin routes in Next.js are at /admin/teams/[teamId] with extensive sub-routes (scheduling, programming, scaling, coaches, gym-setup, classes, schedule-templates, schedule-week). 5) Action files need conversion to TanStack server functions in server-fns/. 6) Layout strategy: use _protected/_settings and _protected/_admin layouts. Document created at docs/tasks/tanstack-migration-settings-admin.md with full component inventory and migration strategy.","created_at":"1766529368302.0"}
{"id":"321aaf91-2dc9-41c0-accd-60473791f644","information":"WODsmith Lexical editor component pattern: Create separate toolbar component to keep editor logic clean. Toolbar uses useLexicalComposerContext() hook to access editor instance. Track selection state (bold, italic, underline) by registering update listener with editor.registerUpdateListener(). Dispatch commands via editor.dispatchCommand(FORMAT_TEXT_COMMAND, format). Read-only viewer uses same node configuration but sets editable: false in config. Both need \"use client\" directive.","created_at":"1766381993997.0","tags":"lexical,editor,React,component-pattern,toolbar,WODsmith"}
{"id":"333cc9c0-fa81-4eaf-8924-22ababec3935","information":"## Alchemy CI/CD for PR Preview Environments - Complete Guide\n\n### 1. PR-Based Preview Environment Support\n\n**YES, Alchemy has BUILT-IN support for PR preview environments.** The official CI guide provides a complete workflow.\n\n#### How It Works:\n- Each PR gets a dynamically named stage: `pr-<number>` (e.g., `pr-42`)\n- Stage determines resource naming: `wodsmith-db-pr-42`, `wodsmith-sessions-pr-42`, etc.\n- Resources are ephemeral - created on PR open, destroyed on PR close/merge\n- GithubComment resource auto-updates PR with preview URL\n\n#### Stage Naming Pattern:\n```typescript\n// In GitHub Actions env:\nSTAGE: github.event_name == 'pull_request' && format('pr-{0}', github.event.number) || (github.ref == 'refs/heads/main' && 'prod' || github.ref_name)\n```\n\n### 2. Resource Lifecycle Management\n\n#### Creating Resources:\nAll Cloudflare resources (Worker, D1, KV, R2) are created automatically by Alchemy based on stage.\n```bash\nbun alchemy deploy --stage pr-42\n```\n\n#### Destroying Resources:\n```bash\nbun alchemy destroy --stage pr-42\n```\nThe `destroy` command removes ALL resources for that stage - Worker, D1 database, KV namespace, R2 bucket, etc.\n\n#### Safety Check (CRITICAL):\nAlways add safety check in cleanup job to prevent accidental prod destruction.\n\n### 3. State Management for PR Environments\n\n#### CloudflareStateStore (RECOMMENDED for CI):\nUses a Cloudflare Worker + Durable Object + SQLite for persistent state storage.\n```typescript\nimport { CloudflareStateStore } from \"alchemy/state\";\n\nconst app = await alchemy(\"my-app\", {\n  stateStore: (scope) => new CloudflareStateStore(scope)\n});\n```\n\n#### Why CloudflareStateStore for CI:\n- State persists across CI runs (no need to recreate resources)\n- All CI runners share the same state\n- Scoped by stage - PR states don't conflict\n- Requires `ALCHEMY_STATE_TOKEN` env var (generate with `openssl rand -base64 32`)\n\n### 4. Required Secrets\n\n| Secret | Purpose |\n|--------|---------|\n| `ALCHEMY_PASSWORD` | Encrypts state files |\n| `ALCHEMY_STATE_TOKEN` | Auth for CloudflareStateStore |\n| `CLOUDFLARE_API_TOKEN` | Cloudflare API access |\n| `CLOUDFLARE_EMAIL` | Cloudflare account email |\n\n### 5. GitHub Comment for Preview URL\n\n```typescript\nimport { GitHubComment } from \"alchemy/github\";\n\nif (process.env.PULL_REQUEST) {\n  await GitHubComment(\"preview-comment\", {\n    owner: \"your-username\",\n    repository: \"your-repo\",\n    issueNumber: Number(process.env.PULL_REQUEST),\n    body: `Preview deployed to ${website.url}`\n  });\n}\n```\n\n### 6. D1 Migrations\n\nMigrations are applied automatically by Alchemy D1Database resource on every deployment including PR previews. Each PR stage gets a fresh database.\n\n### 7. Limitations/Gotchas:\n\n1. CloudflareStateStore creates an `alchemy-state-service` Worker in your account\n2. ALCHEMY_STATE_TOKEN must be consistent across all deployments\n3. D1 data is NOT migrated between PRs - each PR gets fresh empty database\n4. Cleanup job MUST run to avoid orphaned resources\n5. Concurrency group prevents race conditions - use `cancel-in-progress: false`","created_at":"1767285946688.0"}
{"id":"34095bbe-fbcb-420f-afa7-81abaf086d68","information":"Bug fix pattern: When server actions return partial data (e.g., just DB row without relations), client components that manually merge server response into local state will lose enriched data fields. In this case, approveOrganizerRequest returned OrganizerRequest (just reviewedBy: string) but the component expected OrganizerRequestWithDetails which includes reviewer: {id, firstName, lastName}. The fix was to use router.refresh() to refetch complete server-rendered data instead of manually merging incomplete action responses into local state. Also removed local useState since it would not update on refresh anyway - use props directly when relying on server refresh pattern.","created_at":"1767033469852.0","metadata":"{\"context\":\"organizer-requests-approval\"}","tags":"bug-fix,react,nextjs,server-actions,router-refresh,local-state,data-sync"}
{"id":"34bf73ea-760b-493d-b07f-ea3a25fd8220","information":"WODsmith monorepo package ecosystem patterns for test-utils:\n\nNAMING: Uses @repo/* for internal packages (@repo/zsa, @repo/zsa-react, @repo/typescript-config). This differs from plan's @wodsmith/test-utils - should use @repo/test-utils for consistency.\n\nSTRUCTURE: All packages export TypeScript source directly via src/ (no build step for internal consumption). Main entry via \"exports\": { \".\": \"./src/index.ts\" }. Uses tsup only for external publishing (private: true packages skip this).\n\nCROSS-PACKAGE DEPS: Uses workspace:* protocol (e.g., \"@repo/zsa\": \"workspace:*\"). TypeScript config extends via @repo/typescript-config/base.json. Peer dependencies use catalog: protocol for version consistency.\n\nTESTING: Only wodsmith app has tests (40+ files in test/). No package-level tests. Uses Vitest 3.2.3 with jsdom, vite-tsconfig-paths for path aliases, @testing-library/react. Mock strategy: chainable db mock in test/setup.ts, not real fakes.\n\nCATALOG: pnpm-workspace.yaml defines shared dependency versions (zod, react, etc.) via catalog: feature. Packages reference as \"zod\": \"catalog:\".\n\nTURBO: test task has dependsOn: [\"^build\"] but packages don't have build outputs since they export source. This works because Next.js transpiles on-the-fly.\n\nIMPLICATIONS FOR TEST-UTILS:\n- Use @repo/test-utils (not @wodsmith)\n- Export source from src/, no build step needed\n- Vitest config can extend @repo/test-utils/vitest-base\n- Add to pnpm catalog if test deps should be shared\n- Current chainable mock in test/setup.ts is a migration candidate for FakeDatabase pattern","created_at":"1766211179372.0"}
{"id":"351ebe96-9c8d-443b-a25c-687e6fe4a758","information":"## WodSmith Start Entitlement System Implementation\n\n### Three Entitlement States for Organizers:\n1. **No Entitlement**: Team lacks HOST_COMPETITIONS feature → Redirect to /compete/organizer/onboard\n2. **Pending**: Has HOST_COMPETITIONS BUT limit=0 → Show PendingOrganizerBanner, allow drafts only\n3. **Approved**: Has HOST_COMPETITIONS AND limit=-1 (or >0) → Full access\n\n### Key Functions in entitlements.ts:\n- `hasFeature(teamId, featureId)` - Check snapshotted team features, respects overrides\n- `getTeamLimit(teamId, limitKey)` - Get team limit, checks overrides first then snapshots\n- `isTeamPendingOrganizer(teamId)` - Returns true if MAX_PUBLISHED_COMPETITIONS === 0\n- `getTeamPlan(teamId)` - Returns plan with snapshotted features and limits\n\n### TanStack Start Pattern for Server Functions:\nMust use dynamic imports inside createServerFn handler to avoid bundling cloudflare:workers.\n\n### Route Context Pattern:\nThe entitlement state is passed via beforeLoad to component context, allowing child routes to access entitlement state for conditional rendering (e.g., pending approval banner).","created_at":"1767209669959.0"}
{"id":"3708f5a8-a4f1-4a12-92e7-6d944ad276de","information":"TanStack Start server function pattern for WODsmith sponsor-fns.ts migration: Successfully ported 13 server functions from Next.js sponsors.ts to TanStack createServerFn pattern. Key patterns: 1) Use local hasTeamPermission/requireTeamPermission helpers (inline in file, not from utils/team-auth) that use getSessionFromCookie(), 2) All mutations use method: 'POST', all queries use method: 'GET', 3) Input validation via .inputValidator() with Zod schemas, 4) Return objects wrapped in named properties (e.g. {sponsor: Sponsor} not just Sponsor), 5) Permission checks happen early in handler before DB operations, 6) For competition-related operations, fetch competition first to get organizingTeamId for permission check using TEAM_PERMISSIONS.MANAGE_PROGRAMMING, 7) Use and() for multiple WHERE conditions from drizzle-orm, 8) Always return .returning() on insert/update/delete, 9) Handle null/undefined distinctly in Zod schemas (use .nullable() or .optional() as needed), 10) Import pattern: createServerFn from @tanstack/react-start, z from zod, drizzle operators from drizzle-orm, schema tables from @/db/schemas/*, getDb from @/db, getSessionFromCookie from @/utils/auth. No type-check errors on completion.","created_at":"1766617766638.0","tags":"tanstack-start,server-functions,migration,sponsors,wodsmith,permissions,drizzle-orm,zod-validation,createServerFn"}
{"id":"376e97b8-3c4f-48a5-88d5-a78eb35a128b","information":"WODsmith migration scripts follow these patterns:\n1. Import from getDb() for database access\n2. Use db.query API for reading with relations\n3. Use db.insert().values().returning() for creating records\n4. Track success/error counts and report at end\n5. Use try/catch blocks for individual operations\n6. Exit with code 0 on success, 1 on errors\n7. Print clear progress messages with emoji indicators\n8. When detecting patterns in data, group by composite keys and process in memory\n9. For linking records, create a Map to track relationships before batch updates","created_at":"1765995243914.0"}
{"id":"384808aa-9b51-4940-886f-e5b2b5911822","information":"When fixing Drizzle type errors for queries with .with() relations: 1) Import the base type from schema (e.g., TrackWorkout), 2) Create a type alias intersecting base type with relation (e.g., TrackWorkout & { workout: Workout }), 3) Cast the query result to the type alias. This pattern works because Drizzle's query builder with .with() doesn't automatically narrow return types to include relations, but the cast tells TypeScript the actual shape. Applied successfully in competition-workouts.ts to fix 10 type errors accessing trackWorkout.workout properties.","created_at":"1766093460803.0"}
{"id":"3955ebe1-eb2c-44d4-be57-f1c8d506fc47","information":"WODsmith deleteVolunteerRotationsAction pattern: Created server action for batch deleting all rotations for a specific volunteer in an event. Uses direct db.delete() with and() condition matching teamId, membershipId, and trackWorkoutId. Returns deletedCount from result.length. Include revalidatePath after deletion. More efficient than looping deleteJudgeRotation because it's a single SQL DELETE operation. Schema requires teamId, membershipId, trackWorkoutId.","created_at":"1766081530554.0"}
{"id":"3a921b22-f5fe-48e0-a286-ee72b9e1c004","information":"WODsmith TanStack Start heat schedule manager TDD implementation pattern:\n\n1. Tests go in test/components/compete/organizer/heat-schedule.test.tsx\n2. Use factory functions for test data (createTestHeat, createTestVenue, createTestWorkout, createTestAssignment)\n3. Don't use @testing-library/user-event (not installed) - use fireEvent from @testing-library/react instead\n4. Server functions use {data: {...}} format when called directly: getHeatsForCompetitionFn({data: {competitionId}})\n5. Type HeatWithAssignments from @/server-fns/competition-heats-fns includes venue, division, and assignments\n6. Type CompetitionWorkout from @/server-fns/competition-workouts-fns includes workout details and heatStatus\n7. Radix UI Dialog requires DialogTitle for accessibility - always include it\n8. For unused props that will be used later, prefix with underscore: competitionId: _competitionId\n9. Tests run with: pnpm vitest run test/components/compete/organizer/heat-schedule.test.tsx","created_at":"1766644621974.0"}
{"id":"3bc5582a-71f1-4c91-b5be-389ac5fec43a","information":"WODsmith test factories implementation pattern: Created test data factories (user, team, workout, session) with the pattern: 1) Generate unique IDs with createId() from @paralleldrive/cuid2 by default but allow overrides, 2) Use sensible defaults (e.g., email derived from id slice, timestamps as `new Date()`), 3) Accept Partial<Factory> overrides via spread operator AFTER defaults, 4) Session factory matches Lucia's SessionWithMeta structure exactly (includes user object, teams array, activeTeamId), 5) FakeSessionStore provides in-memory session storage with async Map-based get/set/delete/reset methods for testing KV sessions. TypeScript gotcha: When testing array access like session.teams[0].roleId, must use optional chaining session.teams[0]?.roleId to avoid TS2532 \"Object is possibly undefined\" errors even when expect().toHaveLength(1) precedes it. Pattern successfully generates test data with 100% type safety and full override flexibility.","created_at":"1766266077552.0"}
{"id":"3f7a80b7-b669-46e1-94ad-73da58ec2287","information":"WODsmith volunteer auto-approval implementation: Created processApprovedInvitationsForEmail function in team-members.ts that runs during user signup. It finds team_invitation records matching user email where metadata.status === \"approved\", creates team_membership for each (copying metadata), marks invitations accepted, and updates user sessions. Pending invitations (status !== \"approved\") remain as invitations. Function is called from signUpAction after createPersonalTeamForUser, wrapped in try-catch to avoid failing signup if invitation processing fails. Uses case-insensitive email comparison (toLowerCase()). Skips if membership already exists.","created_at":"1766119764317.0"}
{"id":"3f90382e-6dc5-4888-8b05-897d4eadcfc8","information":"Created competition-organizer-docs skill at .claude/skills/competition-organizer-docs/ with:\n1. SKILL.md (223 lines) - Main skill file with organizer persona, workflow-to-doc mappings, structured output templates for CI\n2. references/workflows.md (817 lines) - Complete specifications for all 15 organizer workflows with route mappings, key components, doc requirements, and CI automation patterns\n\nKey patterns used:\n- Progressive disclosure: SKILL.md contains summary tables, workflows.md has full details\n- Integration with documentation skill: explicitly references loading documentation skill first\n- Diataxis mapping: 4 tutorials, 13 how-to guides, 6 references, 4 explanations\n- CI automation: file patterns that trigger documentation updates with YAML templates\n- User journeys: First-time organizer (11 steps), Event Day Operations, Post-Competition\n\nThe skill follows the skill-creator patterns: concise SKILL.md body, detailed reference files, no extraneous documentation files.","created_at":"1767131882134.0"}
{"id":"41a96990-15ff-4fad-9b40-3b58823f4e9d","information":"Radix UI dropdown components do not work with vi.useFakeTimers() in Vitest tests. Root cause: Radix UI uses real async operations for dropdown animations and portal rendering. Using fake timers causes waitFor() to timeout because waitFor() internally uses real timers. Solution: Remove vi.useFakeTimers() and use real timers with waitFor(). Use screen.findByText() for async element discovery instead of waitFor(() => fireEvent.click()). Only use fake timers when testing actual debounced logic - if there is no debouncing in the component do not use fake timers. Example: WorkoutControls test had fake timers but component had no debouncing - removing fake timers fixed the timeout.","created_at":"1766273802651.0"}
{"id":"42d97316-44a5-4e16-aac1-f3fa4555f46a","information":"## Alchemy Secret Handling - Complete Reference\n\n### 1. Wrapping Secrets with alchemy.secret()\n\nThe `alchemy.secret()` function is the primary API for handling sensitive values:\n\n```typescript\n// Create secret from environment variable\nconst apiKey = alchemy.secret(process.env.API_KEY);\n\n// Multiple secrets\nconst secrets = {\n  API_KEY: alchemy.secret(process.env.API_KEY),\n  DATABASE_URL: alchemy.secret(process.env.DATABASE_URL),\n  JWT_SECRET: alchemy.secret(process.env.JWT_SECRET)\n};\n```\n\n**What counts as secrets:**\n- API keys and tokens\n- Passwords and credentials\n- Private certificates\n- Connection strings with credentials\n\n### 2. State File Encryption\n\nSecrets are automatically encrypted when stored in state files. The encryption uses a password provided during app initialization:\n\n```typescript\nconst app = await alchemy(\"my-app\", {\n  stage: \"dev\",\n  password: process.env.ALCHEMY_PASSWORD, // or SECRET_PASSPHRASE\n});\n```\n\n**Encrypted format in state JSON:**\n```json\n{\n  \"props\": {\n    \"key\": {\n      \"@secret\": \"Tgz3e/WAscu4U1oanm5S4YXH...\"\n    }\n  }\n}\n```\n\nThe `@secret` key indicates an encrypted value that Alchemy will decrypt at runtime using the password.\n\n### 3. Passing Secrets to Worker Bindings\n\nSecrets can be passed directly to Cloudflare Worker bindings. Alchemy handles the secure transmission:\n\n```typescript\nconst worker = await Worker(\"my-worker\", {\n  name: \"my-worker\",\n  script: workerScript,\n  format: \"esm\",\n  bindings: {\n    API_KEY: alchemy.secret(process.env.API_KEY),\n    DATABASE_URL: alchemy.secret(process.env.DATABASE_URL),\n    JWT_SECRET: alchemy.secret(process.env.JWT_SECRET)\n  }\n});\n```\n\nFor TanStack Start apps with Cloudflare resources (D1, KV, R2), bindings are passed via resource references, not raw secrets:\n\n```typescript\nconst website = await TanStackStart(\"app\", {\n  bindings: {\n    DB: db,\n    KV_SESSION: kvSession,\n    R2_BUCKET: r2Bucket,\n  },\n});\n```\n\n### 4. CI/CD Best Practices\n\n**State Storage:**\n- Local dev: FileSystemStateStore in .alchemy directory\n- CI/CD: CloudflareStateStore for persistent shared state across ephemeral runners\n\n```typescript\nconst app = await alchemy(\"wodsmith\", {\n  stage,\n  stateStore: process.env.CI\n    ? (scope) => new CloudflareStateStore(scope)\n    : undefined,\n});\n```\n\n**Environment Variables Required:**\n- ALCHEMY_PASSWORD or SECRET_PASSPHRASE - Encryption key for secrets\n- CLOUDFLARE_API_TOKEN - For deploying to Cloudflare\n- Stage-specific secrets as needed\n\n**GitHub Actions Pattern:**\n```yaml\nenv:\n  ALCHEMY_PASSWORD: secrets.ALCHEMY_PASSWORD\n  CLOUDFLARE_API_TOKEN: secrets.CLOUDFLARE_API_TOKEN\n```\n\n**Security Notes:**\n- Never commit .alchemy state files with unencrypted secrets\n- Use different ALCHEMY_PASSWORD per environment or stage if needed\n- CloudflareStateStore keeps state off disk entirely for CI","created_at":"1767288850766.0"}
{"id":"44ba14f3-4b40-410d-9802-4e44be1ac128","information":"WODsmith volunteer list invitation-based flow update: Modified volunteers page and list component to fetch and display BOTH team invitations (pending) and team memberships (approved). Key implementation:\n\n1. Created getPendingVolunteerInvitations() in src/server/volunteers.ts to query invitations with roleId=VOLUNTEER, isSystemRole=1, acceptedAt=null\n\n2. Updated page.tsx to fetch both invitations and memberships in parallel\n\n3. Created discriminated union type VolunteerItem = {type: \"invitation\", data: TeamInvitation} | {type: \"membership\", data: VolunteerWithAccess}\n\n4. Converted invitations to VolunteerWithAccess format for display (userId=\"\", user=null, isActive=0, hasScoreAccess=false)\n\n5. Tabs now show: All (invitations + memberships), Pending (invitations only), Approved (memberships only)\n\nCritical: When filtering union types, use type guards (if item.type === \"invitation\") to narrow types correctly before accessing discriminated properties. Without this, TypeScript loses the discriminant and treats item.data as the full union type.","created_at":"1766120485081.0"}
{"id":"46dbf08e-c755-4204-82ce-e2fc6167c247","information":"WODsmith volunteer sign-up pattern: Public volunteers are created with placeholder users (no password, unverified email) + teamMembership with VOLUNTEER role (isActive=0 for pending). Metadata stores: status (\"pending\"|\"approved\"|\"rejected\"), signupEmail, signupName, signupPhone, availabilityNotes. Duplicate detection checks both metadata.signupEmail and existing user.email before creating. Created users can later claim accounts by signing up with the same email.","created_at":"1765953171440.0"}
{"id":"474a2ac8-cd9d-4f8a-8b58-032e3cb89f00","information":"WODsmith E2E testing infrastructure: Created Playwright fixtures and page objects per testing-rig-integration-plan.md Phase 3.3. Implemented:\n1. e2e/fixtures/auth.ts - Authentication helpers (loginAsTestUser, createAuthenticatedContext, logout) with redirect waits to /workouts\n2. e2e/fixtures/test-data.ts - Seeded data references (users, teams, workouts) and API wait helpers\n3. e2e/pages/login.ts - LoginPage POM with selectors, login(), assertLoggedIn/Out(), error assertions\n4. e2e/pages/dashboard.ts - DashboardPage POM for /admin page with navigation helpers, assertOnDashboard(), user menu interactions\n5. Index files for clean imports\n\nKey patterns: Page Object Model with method chaining, data-testid for stable selectors, waitForURL for navigation assertions, explicit waits for API calls. Test user credentials at TEST_USER.email/password. Sign-in redirects to /workouts, admin dashboard at /admin. All fixtures use Playwright types and async/await.","created_at":"1766268854858.0"}
{"id":"4afeb124-44d8-4469-bfb7-3030d95a549c","information":"## Alchemy \"Database/Resource Already Exists\" Error Fix\n\n**Error Pattern:**\n```\nCloudflareApiError: Failed to create D1 database \"name\" (400 Bad Request):\n- [7502] Database with name: 'name' already exists\n```\n\n**Root Cause:** Alchemy state file has `\"status\": \"creating\"` but no resource UUID. Happens when previous deployment failed mid-creation but resource was actually created in Cloudflare.\n\n**Diagnosis:**\n1. Check `.alchemy/{app}/{stage}/*.json` files for `\"status\": \"creating\"`\n2. Compare with actual resources using `wrangler d1 list`, `wrangler kv namespace list`, `wrangler r2 bucket list`\n\n**Fix:** Update the state file to:\n1. Change `\"status\": \"creating\"` to `\"status\": \"updated\"`\n2. Add the resource ID/UUID from Cloudflare to the `output` object\n3. For D1: use `\"type\": \"d1\"`, `\"id\": \"uuid\"`, `\"name\": \"db-name\"`\n4. For KV: use `\"type\": \"kv_namespace\"`, `\"namespaceId\": \"id\"`, `\"title\": \"namespace-name\"`\n5. For R2: use `\"type\": \"r2_bucket\"`, `\"name\": \"bucket-name\"`, include `\"location\"`, `\"accountId\"`\n6. For Worker: copy full props into output object\n\n**Reference working state files:** Check `.alchemy/{app}/prod/*.json` for correct formats.\n\n**Prevention:** Alchemy lacks \"adopt\" mechanism. If interrupted mid-deployment, manually reconcile state files with actual Cloudflare resources.","created_at":"1767132215222.0"}
{"id":"4b12b82d-f87e-40a6-b26c-5b6d380ac150","information":"TanStack Start migration test coverage audit findings (December 2025):\n\nEXCELLENT COVERAGE:\n- Scoring library has ~200 unit tests covering encode/decode/format/sort/validate/aggregate\n- Programming actions at 100% coverage with integration tests\n\nCRITICAL GAPS:\n- Log actions: 0/5 tested (submitLogFormAction, getLogsByUserAction, updateResultAction need integration tests FIRST)\n- Movement actions: 0/4 tested (entire section missing from TanStack Start)\n- Calculator: 0/2 routes have tests (pure client-side, easy unit tests)\n\nPARTIAL COVERAGE:\n- Workout actions: 5/21 tested (24%) - createWorkoutAction, createWorkoutRemixAction, updateWorkoutAction, getTeamSpecificWorkoutAction well tested; scheduling/leaderboard/remix-related actions untested\n\nTest file locations:\n- Action tests: apps/wodsmith/test/actions/\n- Integration tests: apps/wodsmith/test/integration/\n- Unit tests: apps/wodsmith/test/lib/scoring/\n- Utils tests: apps/wodsmith/test/utils/\n\nTesting trophy philosophy: Integration tests for actions (mock boundaries), unit tests for pure functions (scoring), E2E for critical paths only.","created_at":"1766641615989.0"}
{"id":"4c436dc6-85fd-4ffe-b0d2-b87953b22f67","information":"Vitest workspace config: Exclude Playwright e2e tests from vitest by adding exclude: [\"./e2e/**\"] to the test config. Prevents playwright tests from being picked up by vitest runner. E2E tests should only run via playwright, not vitest.","created_at":"1766272618151.0","tags":"vitest,playwright,e2e,test-config,exclude"}
{"id":"4e4615d4-8123-4d27-8296-830cc84cb554","information":"React 19 + Radix UI Form Components Testing Issue: Components using @radix-ui/react-slot (Form, Select, Popover, etc.) cause infinite loops in Vitest tests due to react-compose-refs bug. Error: \"Maximum update depth exceeded\" in @radix-ui/react-compose-refs. Tracked at: https://github.com/radix-ui/primitives/issues/1672\n\nRoot cause: react-compose-refs calls setState in a way that triggers infinite updates in React 19.\n\nFailed workarounds:\n1. Element.prototype.hasPointerCapture/setPointerCapture/releasePointerCapture mocks - no effect\n2. Mocking Form components - causes test hangs\n3. Mocking Slot component - still causes loops\n\nSolutions that might work:\n1. Wait for Radix to release React 19-compatible version (@radix-ui/react-compose-refs fix)\n2. Downgrade to React 18 for testing\n3. Use testing-library/react with React 18 while app uses React 19\n4. Skip all tests using Form/Select until fixed (current approach)\n\nAffected components: Form, FormField, FormControl, Select, Popover, Dropdown, any component using Slot internally.\n\nThis is a global test infrastructure issue, not a per-test-file problem.","created_at":"1766274113649.0"}
{"id":"4eeb6905-708e-48c0-9130-40f81d7151c8","information":"WODsmith client demo transcript L1-L2 processing pattern: Use NON-DESTRUCTIVE approach - prepend YAML frontmatter + ## Summary section, keep original transcript under ## Transcript header. Extract pain points as verbatim quotes with context. Include decisions, actions, notable quotes, and architecture insights. For truncated transcripts, add transcript_note field in frontmatter to flag incomplete data.","created_at":"1766164457294.0"}
{"id":"4fccef2b-dddd-4851-9466-843fb43ff847","information":"WODsmith internal transcript processing patterns: L1-L2 workflow requires frontmatter with title, date, type, attendees, tags, summary, decisions, actions, pains, status. Bold key insights: decisions (10-20% of content), pain points, action items, blockers, architectural choices. Common tags: scheduling, programming-track, commerce, payments, registration, teams, scoring, leaderboard, ux, architecture.","created_at":"1766163424887.0"}
{"id":"5134f174-bd25-4c9d-a095-06a2ca58fff7","information":"WODsmith Admin Competitions E2E test pattern: Created Playwright tests for admin-only page at /admin/competitions. Key patterns used:\n1. loginAsAdmin() helper from fixtures/auth.ts for admin authentication\n2. Tests designed to handle both empty state (no competitions) and with-data states using conditional test.skip()\n3. Dropdown menu testing requires hover() on .group row first to reveal actions button\n4. Competition rows link to /compete/organizer/{id} - use locator('a[href^=\"/compete/organizer/\"]') \n5. Non-admin access test verifies requireAdmin() + notFound() pattern works\n6. Filter tabs use Button with variant=\"default\" for active, variant=\"outline\" for inactive\n7. Search placeholder: \"Search competitions or organizers...\"\nNote: Full happy path testing requires seeding competitions in seed-e2e.sql which needs organizing team + competition_event team + competition records.","created_at":"1766983651676.0"}
{"id":"51eb7c0e-941a-437b-af9f-2759b63aee8b","information":"## Alchemy D1 Local Database Location Mismatch (wodsmith-start)\n\n**Root cause:** Alchemy Vite plugin and wrangler use DIFFERENT persist locations for local D1 databases:\n- Vite plugin defaults to: `{workspace-root}/.alchemy/miniflare/v3/`\n- Wrangler `db:migrate:local` uses: `{app-dir}/.alchemy/local/.wrangler/state/v3/`\n\nThis causes \"no such table\" errors because migrations are applied to wrangler's location but Vite reads from its own location.\n\n**Solution:** Configure Vite alchemy plugin with `persistState.path` to align with wrangler:\n```typescript\nalchemy({\n  persistState: {\n    path: \"./.alchemy/local/.wrangler/state\",\n  },\n}),\n```\n\n**Key files:**\n- `vite.config.ts` - configure persistState\n- `.alchemy/local/wrangler.jsonc` - wrangler config (auto-generated by `bun alchemy.run.ts`)\n- `alchemy/src/cloudflare/miniflare/paths.ts` - shows default path logic\n\n**Related commands:**\n- `pnpm alchemy:dev` - runs alchemy.run.ts AND applies migrations (correct workflow)\n- `pnpm dev` - just runs Vite (may use stale/empty database if migrations not applied)\n\n**Correct dev workflow:**\n1. `pnpm alchemy:dev` - initialize alchemy config and apply migrations\n2. `pnpm dev` - start Vite dev server (now uses migrated database)","created_at":"1767112558602.0"}
{"id":"5338de0c-e17b-4a79-8339-501dd87fad61","information":"TanStack Start Virtual Module Resolution Error Fix:\n\nERROR: \"Failed to resolve import 'tanstack-start-injected-head-scripts:v'\"\n\nROOT CAUSE: Importing server-only functions from `@tanstack/react-start/server` at the top level of files that are processed on both client and server (like `__root.tsx`, `router.tsx`, or any route file).\n\nThe TanStack Start plugin registers virtual modules (like `tanstack-start-injected-head-scripts:v`) only for the server environment. When you import server-only functions at the top level, Vite tries to resolve them for the client bundle too, which fails.\n\nCOMMON PROBLEMATIC IMPORTS:\n- `import { getCookie } from \"@tanstack/react-start/server\"`\n- `import { getRequestUrl } from \"@tanstack/react-start/server\"`\n- `import { getRequestHeaders } from \"@tanstack/react-start/server\"`\n\nSOLUTION: Wrap server-only code in a `createServerFn`:\n```typescript\nexport const getThemeCookieFn = createServerFn({ method: \"GET\" }).handler(\n  async () => {\n    const { getCookie } = await import(\"@tanstack/react-start/server\")\n    return getCookie(\"theme\")\n  },\n)\n```\n\nThen call the server function instead of using the import directly.\n\nALSO APPLIES TO:\n- PostHogProvider or other client-only providers in router.tsx InnerWrap (moves import chain to client bundle attempt)\n- Any file that imports from @tanstack/react-start/server outside of createServerFn handlers\n\nGitHub Issues: #5196, #6189","created_at":"1767201592511.0"}
{"id":"54838f09-ede8-4a41-ace2-dca12cca9f00","information":"WODsmith judge rotation buffer validation: Extended validateRotationConflicts() in judge-rotations.ts to check heat buffer violations. Added \"buffer_violation\" conflict type to RotationConflict interface. Implementation fetches minHeatBuffer from track_workouts (defaults to 2), expands existing rotations to assignments, calculates buffer zones before/after each rotation (N heats before start, N heats after end), and checks if proposed rotation falls within any buffer zone. Buffer applies bidirectionally to prevent judge fatigue. Follows same pattern as double-booking conflict detection.","created_at":"1766094246096.0","metadata":"{\"file\":\"src/server/judge-rotations.ts\",\"task\":\"thewodapp-bf8.3\",\"feature\":\"judge-scheduling\",\"pattern\":\"conflict-validation\"}"}
{"id":"5533d48d-d60e-4ff2-a185-5e0cf1a21fd4","information":"WODsmith volunteer button implementation: Added volunteer check in competition layout by querying teamMembershipTable with competition.competitionTeamId, checking for SYSTEM_ROLES_ENUM.VOLUNTEER role. Button appears in RegistrationSidebar component above registration status card, links to /compete/[slug]/my-schedule. Uses blue-themed Card with Calendar icon, matching existing sidebar pattern.","created_at":"1766120281755.0"}
{"id":"55b22990-d3b2-4adf-9748-ab07f2795f54","information":"Alchemy IaC - TanStack Start Deployment Pattern:\n\n1. **Create project**: `bunx alchemy create my-app --template=tanstack-start`\n\n2. **TanStackStart resource** (simplified Worker for TanStack):\n```typescript\n// alchemy.run.ts\nimport alchemy from \"alchemy\";\nimport { TanStackStart } from \"alchemy/cloudflare\";\n\nconst app = await alchemy(\"my-tanstack-app\");\nexport const worker = await TanStackStart(\"website\");\nconsole.log({ url: worker.url });\nawait app.finalize();\n```\n\n3. **Vite configuration** - Critical setup:\n```typescript\nimport { tanstackStart } from \"@tanstack/react-start/plugin/vite\";\nimport viteReact from \"@vitejs/plugin-react\";\nimport alchemy from \"alchemy/cloudflare/tanstack-start\"; // Alchemy plugin!\nimport { defineConfig } from \"vite\";\n\nexport default defineConfig({\n  build: {\n    target: \"esnext\",\n    rollupOptions: {\n      external: [\"node:async_hooks\", \"cloudflare:workers\"], // CRITICAL externals\n    },\n  },\n  plugins: [\n    alchemy(), // Provides dev environment shim\n    tsConfigPaths({ projects: [\"./tsconfig.json\"] }),\n    tanstackStart({\n      target: \"cloudflare-module\", // REQUIRED for CF Workers\n      customViteReactPlugin: true,\n    }),\n    viteReact(),\n  ],\n});\n```\n\n4. **Type definitions** (`types/env.d.ts`):\n```typescript\nimport type { worker } from \"../alchemy.run.ts\";\nexport type CloudflareEnv = typeof worker.Env;\ndeclare global { type Env = CloudflareEnv; }\ndeclare module \"cloudflare:workers\" {\n  namespace Cloudflare { export interface Env extends CloudflareEnv {} }\n}\n```\n\n5. **tsconfig.json updates**:\n- Add `\"types\": [\"@cloudflare/workers-types\", \"./types/env.d.ts\"]`\n- Include `alchemy.run.ts` in compilation\n\n6. **Commands**:\n- `bun run dev` - Local development\n- `bun run deploy` (runs alchemy deploy)\n- `bun run destroy` - Cleanup\n\n**CRITICAL**: Requires `.env` with `ALCHEMY_PASSWORD=change-me` for secret encryption in state.","created_at":"1767043894141.0","tags":"alchemy,tanstack-start,deployment,cloudflare,vite,workers"}
{"id":"57fe47f8-7d67-45fa-9a4c-3e0b4576c389","information":"TanStack Start migration audit findings for WODsmith: Workout actions 38% migrated (8/21), Log actions 140% migrated (7 vs 5), Movements 100% missing, Calculator 100% missing. Critical gaps: log edit route and add-to-track route. Total route migration 50% (10/20).","created_at":"1766530486770.0"}
{"id":"58bb2a77-ed97-4151-8aff-7813264eb7d3","information":"**TanStack Start: Head Scripts, Cookies, and Dark Mode Flash Prevention**\n\n## 1. Injecting Scripts into head\n\nTanStack Start supports blocking scripts via the head() function in route config. The head() function runs SERVER-SIDE and client-side. Scripts defined here are rendered via HeadContent component.\n\nFor inline blocking scripts (dark mode flash prevention): Add raw script tags BEFORE HeadContent in the shellComponent or RootDocument using dangerouslySetInnerHTML.\n\n## 2. Server-Side Cookie Access\n\nYES - use middleware with getCookie() and setCookie() from @tanstack/react-start/server. beforeLoad and loader functions with ssr: true (default) execute server-side on initial request - they can access request context via middleware.\n\n## 3. Custom HTML Document\n\nUse shellComponent in createRootRoute() for full control over html element attributes.\n\n## 4. Dark Mode Flash Prevention Pattern\n\nCombine inline blocking script + server cookie reading:\n1. Blocking script (runs before paint): Set class on html from localStorage/system preference  \n2. Server middleware: Read theme cookie to server-render correct class\n3. Client sync: Set cookie from client on first visit for subsequent SSR\n\nKey insight: TanStack Start does NOT have a built-in dark mode solution. You must manually wire up the inline script + cookie middleware pattern.","created_at":"1767136275897.0"}
{"id":"5c129eb6-b917-4a65-b755-c5b500877807","information":"Updated unit-test skill with TDD Red-Green-Refactor cycle, Arrange-Act-Assert pattern, and anti-patterns (overspecified tests, testing state not behavior, multiple unrelated assertions). Key insight: THE WORST anti-pattern is overspecified tests that test HOW instead of WHAT - they break on refactor even when behavior unchanged. Referenced global testing-patterns skill for Feathers dependency-breaking techniques (25 techniques in catalog). Kept existing mock boundaries pattern. Condensed from 330 lines to 198 lines by removing verbose examples, combining sections, using more compact code snippets. Skill covers: TDD cycle (non-negotiable), AAA structure, one concept per test, pure function testing, mocking at boundaries, what to test vs mock, dependency breaking, test organization.","created_at":"1766352413798.0","tags":"skill-update,tdd,testing,anti-patterns,condensing-documentation,wodsmith"}
{"id":"5c580ca8-2818-4e96-930c-fbefa71170da","information":"When making a foreign key column nullable in Drizzle ORM (e.g., removing .notNull()), check all code that accesses the related data. In WODsmith's case:\n\n1. Functions that load relations with `.with()` already handle undefined using optional chaining (e.g., `invitedByUser?.firstName`)\n2. Components that display related data should check field existence before rendering (e.g., `{user.firstName && <>{user.firstName}</>}`)\n3. The migration SQL creates a new table without NOT NULL constraint and copies data over\n\nThis pattern is already defensive in the codebase - existing code handles nullable relations safely.","created_at":"1766119083259.0","metadata":"{\"task\":\"drizzle-nullable-fk\",\"context\":\"schema-migration\",\"pattern\":\"defensive-code\"}"}
{"id":"5d809bb9-922a-4775-94f4-8e1dead54cc8","information":"Successfully migrated workout-permissions.test.ts to use createTestSession from @repo/test-utils/factories. Key insights: 1) The createTestSession factory accepts both SessionWithMeta overrides AND factory-specific options (userId, teamId, teamSlug, permissions, etc). 2) Can pass user object directly as override to customize user properties while using factory defaults for everything else. 3) The factory auto-generates proper structure with role.id, role.name, isSystemRole, version fields. 4) Reduced 30+ lines of boilerplate to ~20 lines with better maintainability. 5) Tests passed without modification because factory produces KVSession-compatible structure.","created_at":"1766271752636.0","tags":"testing,factories,test-utils,migration,vitest,session-management"}
{"id":"5ee22fb6-2047-49ea-8dfa-30055119dc3e","information":"TanStack Start + Cloudflare Workers: Route files CANNOT import from @/db or any module that imports cloudflare:workers. Vite bundles ALL top-level imports for both client and server bundles, so even if getDb is only used inside createServerFn, the import at the top of the file will be included in the client bundle.\n\nFIX: Move server functions that need DB access to src/server-fns/*.ts files. Route files should only import the exported server function, not getDb directly.\n\nBAD (in route file):\n```typescript\nimport {getDb} from '@/db'  // This breaks client bundle!\nconst myServerFn = createServerFn().handler(async () => {\n  const db = getDb()  // Even though this is server-only\n})\n```\n\nGOOD (in route file):\n```typescript\nimport {myServerFn} from '@/server-fns/my-fns'  // Only import the function\n```\n\nGOOD (in server-fns file):\n```typescript\nimport {getDb} from '@/db'  // Safe here - this file is never in client bundle\nexport const myServerFn = createServerFn().handler(...)\n```\n\nThis pattern applies to ANY Cloudflare-specific import like cloudflare:workers, and any module that transitively imports it.","created_at":"1766703597027.0","tags":"tanstack-start,cloudflare,vite,server-functions,client-bundle,architecture-pattern"}
{"id":"62a5a9f7-06b6-422c-9ce7-775947323418","information":"WODsmith client demo transcript processing patterns: For client demos, extract pain points verbatim as they're gold for product direction. Key categories: (1) Competitor pricing/UX complaints, (2) Backend operational pain (judge scheduling, volunteer management), (3) Missing features in existing tools, (4) Workflow inefficiencies (manual spreadsheets, Google Docs lists), (5) Credential tracking needs, (6) Shift/time-based filtering gaps. Basile (Verdant) revealed Competition Corner doesn't touch volunteer management at all - major opportunity. Jon (Canvas) emphasized need for shift filtering and rotation scheduling visibility.","created_at":"1766163279933.0","metadata":"{\"files\":[\"meetings/client-demos/2025-12-16-basile.md\",\"meetings/client-demos/2025-12-18-jon.md\"],\"domain\":\"transcript-processing\",\"source\":\"cell-ru596g-mjd3vu4oerk\"}"}
{"id":"6308cbd7-c4df-4b17-89f7-09f608ece5fc","information":"Alchemy IaC - Cloudflare Worker Setup Pattern:\n\n1. **Basic Worker definition** in `alchemy.run.ts`:\n```typescript\nimport { Worker } from \"alchemy/cloudflare\";\nexport const worker = await Worker(\"api\", {\n  name: \"api-worker\",\n  entrypoint: \"./src/api.ts\",\n});\n```\n\n2. **Key configuration options**:\n- `url: true` - Enable workers.dev preview URL\n- `cwd` - Project root directory\n- `entrypoint` - Main bundled file\n- `format: \"esm\"` - Module format (default esm)\n- `compatibilityFlags: [\"nodejs_compat\"]` - Node.js compatibility\n- `compatibility: \"node\"` - Preset for common flags\n\n3. **Bindings** (attach resources to Worker):\n```typescript\nbindings: {\n  CACHE: kvNamespace,\n  STORAGE: r2Bucket,\n  DB: d1Database,\n  API_KEY: alchemy.secret(\"secret-value\") // Plain-text converted to plain_text binding\n}\n```\n\n4. **Custom domains** - Two approaches:\n```typescript\n// Direct domains\ndomains: [\"api.example.com\", \"admin.example.com\"]\n\n// Routes with zone\nroutes: [\n  \"backend.example.com/*\",\n  { pattern: \"api.example.com/*\", zoneId: zone.id }\n]\n```\n\n5. **Environment type inference** - No codegen, infer from infrastructure:\n```typescript\n// In worker file\nimport type { worker } from \"../alchemy.run.ts\";\nexport default {\n  async fetch(request, env: typeof worker.Env) {\n    // env is fully typed from bindings\n  }\n}\n```\n\n6. **Dev configuration**:\n```typescript\ndev: {\n  port: 8787,\n  tunnel: true,  // Cloudflare tunnel to local\n  remote: true,  // Run in Cloudflare instead of local\n}\n```\n\n7. **Secrets**: Use `alchemy.secret()` for sensitive values - stored encrypted in state.","created_at":"1767043886576.0","tags":"alchemy,cloudflare,worker,infrastructure-as-code,deployment,bindings,custom-domains"}
{"id":"630e7e6d-9224-436c-bea2-7ac0ba967409","information":"When running `pnpm db:generate` with Drizzle Kit, if you hit an interactive prompt asking \"Is [table] created or renamed from another table?\", this indicates the meta snapshots are out of sync with actual schema. This can happen when a previous migration (e.g., table rename) completed but the meta snapshot wasn't properly updated. Solution: Use `expect` to auto-send Enter key to accept the default \"create table\" option. Example:\n\ncd /path/to/project && expect << 'EOF'\nset timeout 30\nspawn pnpm db:generate --name migration-name\nexpect {\n    -re \".*table.*\" {\n        send \"\\r\"\n        exp_continue\n    }\n    -re \".*migration.*\" {\n        puts \"SUCCESS\"\n    }\n    timeout { puts \"TIMEOUT\" }\n}\nwait\nEOF\n\nThis auto-answers all rename prompts by accepting the first option (create table), which is correct when the rename already happened in a prior migration. Drizzle Kit will generate the correct migration and update the meta snapshots.","created_at":"1766382056194.0","tags":"drizzle,migrations,interactive-prompt,expect,automation"}
{"id":"6486cbbf-d6ed-44b0-af42-022d1308c515","information":"TanStack Start server-fns logging pattern: MUST use dynamic imports inside function handlers to avoid Vite bundling errors with 'cloudflare:workers'. Pattern: `const { logInfo, logError } = await import(\"@/lib/logging/posthog-otel-logger\")`. Use helper function like `async function getLogger() { ... }` for reuse in non-TanStack handler functions. Logger API: logInfo({ message, attributes }), logError({ message, error, attributes }). Use bracketed context prefixes like `[competition]`, `[registration]` in messages.","created_at":"1767136702398.0"}
{"id":"64a49ab5-197f-4791-bfc2-a039d0a0388b","information":"Drizzle ORM type inference issue with `with` clause workaround: When using `db.query.table.findFirst({ with: { relation: true } })`, TypeScript may not properly infer that the relation properties exist on the result type, even though they will be populated at runtime. This causes type errors like \"Property 'relation' does not exist on type...\". \n\nSolution: Convert to explicit joins using `.select().from().innerJoin()` pattern instead of the `with` clause. This provides better type safety as Drizzle correctly infers the result type from the selected fields.\n\nExample:\n```typescript\n// Instead of:\nconst result = await db.query.trackWorkoutsTable.findFirst({\n  where: eq(trackWorkoutsTable.id, id),\n  with: { workout: true, track: true }\n})\n// Type error: result.workout doesn't exist\n\n// Use:\nconst [result] = await db\n  .select({\n    trackWorkoutId: trackWorkoutsTable.id,\n    workoutId: workouts.id,\n    workoutName: workouts.name,\n    // ... other fields\n  })\n  .from(trackWorkoutsTable)\n  .innerJoin(workouts, eq(trackWorkoutsTable.workoutId, workouts.id))\n  .where(eq(trackWorkoutsTable.id, id))\n  .limit(1)\n// Type safe: all fields are properly typed\n```\n\nThis pattern is especially important for D1/SQLite in Next.js projects where type safety is critical.","created_at":"1766093698645.0"}
{"id":"64cfd917-fe61-4707-890e-22adbf8ef71b","information":"shadcn-editor installation pattern for WODsmith: Run `pnpm install` first if you get \"ERR_PNPM_PUBLIC_HOIST_PATTERN_DIFF\" error, then run `pnpm dlx shadcn@latest add @shadcn-editor/editor`. The installer prompts to overwrite tooltip.tsx - choose 'n' to skip if you already have custom tooltip. Additional packages needed: `@lexical/list` and `@lexical/link` for full toolbar functionality (lists, links). Editor stores content as Lexical SerializedEditorState JSON for database storage.","created_at":"1766381992711.0","tags":"shadcn-editor,lexical,WYSIWYG,Next.js,installation,troubleshooting"}
{"id":"65ef3fad-70b6-4a41-9a4e-e39e645b7d03","information":"WODsmith volunteer profile integration: Added pending volunteer invitations and active volunteer memberships to athlete profile page. Volunteer invitations are stored in teamInvitationTable with roleId=VOLUNTEER and metadata.status=\"pending\". Active memberships are in teamMembershipTable with isActive=1 and metadata.status=\"approved\". Competition lookup uses competitionsTable.competitionTeamId to match with invitation/membership.teamId. Used autochunk for safe batching of competition queries to avoid D1's 100 parameter limit. Component shows pending invitations with \"Pending Approval\" badge and active memberships with role type badges and link to /compete/[slug]/my-schedule volunteer dashboard.","created_at":"1766120908316.0"}
{"id":"666ab5f8-ad96-494d-a4a5-ad7e7381c37d","information":"Team context pattern comparison - Next.js vs TanStack Start: Next.js uses 'active team' preference stored in DB via setActiveTeamAction. User selects team in sidebar switcher, preference updates, router.refresh() reloads all server components with new team context. TanStack Start opportunity: Use URL-based team context instead (/team/$teamId, /programming?team=$teamId) for explicit, shareable URLs. Hybrid approach recommended: use preference for main views (/team), explicit URL param for settings/management (/settings/teams/$teamId). URL-based is more RESTful, preference-based is cleaner UX. Choose based on use case.","created_at":"1766529447300.0","tags":"multi-tenancy,team-context,nextjs,tanstack-start,architecture-decision,url-design"}
{"id":"6788a905-7ce2-4ce6-ad8c-7327ba8acf33","information":"WODsmith TanStack migration test coverage audit findings: 1) Existing programming tests are shallow (validate array return, not behavior). 2) Key missing tests: multi-team subscription logic, team-auth utility tests, permission checks integration. 3) CRITICAL behavior to preserve: getTeamProgrammingTracksFn queries subscription table NOT ownership - must test this explicitly. 4) Required test factories: createTeam, createProgrammingTrack, createSubscription (only createTestSession exists). 5) Integration tests are the priority per Testing Trophy - mock at boundaries not internals.","created_at":"1766641586786.0"}
{"id":"6798edcd-2166-400f-ac66-fa34ffc8de2e","information":"Competition Corner help center uses aggressive anti-scraping: articles redirect when accessed directly but collection pages load. Workaround using chrome-devtools: load collection page, use evaluate_script to extract all article titles/URLs, analyze patterns from descriptive titles, sample articles that load successfully. Collection metadata extraction works even when individual articles are blocked.","created_at":"1766354381806.0"}
{"id":"6bbcdc36-d40c-4988-9e92-5d83218178b7","information":"TanStack Start route creation pattern for WODsmith competition organizer pages: 1) Create route at /compete/organizer/$competitionId/<feature>.tsx (not index.tsx for simple pages). 2) Use getRouteApi('/compete/organizer/$competitionId') to access parent loader data (competition object). 3) Fetch feature-specific data in child route loader using server functions from @/server-fns. 4) Import Next.js components using relative path (temporary during migration - components are in apps/wodsmith/src/app). 5) Pass both parent loader data (competition) and child loader data to component. Example: divisions.tsx fetches divisions in loader, accesses competition from parent, renders OrganizerDivisionManager. Server function calls use {data: {param}} pattern. Parent layout validates auth and permissions once.","created_at":"1766618190309.0"}
{"id":"6da7d5bc-6f3a-4cd0-9561-cbc7b7ccde16","information":"## WodSmith Entitlement System - Complete Analysis for Competition Organizing\n\n### Three Entitlement States for Competition Organizers\n\n**STATE 1: NO ENTITLEMENT (Redirect to Onboard)**\n- Condition: User has no teams with HOST_COMPETITIONS feature\n- Check function: getUserOrganizingTeams() in src/utils/get-user-organizing-teams.ts\n- Logic: Filters teams where user has MANAGE_PROGRAMMING permission AND team has HOST_COMPETITIONS feature\n- UI Result: Shows No Organizing Access page with button to apply at /compete/organizer/onboard\n- Location: organizer/layout.tsx line 30-48\n\n**STATE 2: UNAPPROVED (Pending - Private Only + Banner)**\n- Condition: Team has HOST_COMPETITIONS feature BUT MAX_PUBLISHED_COMPETITIONS limit = 0\n- Check function: isTeamPendingOrganizer(teamId) in src/server/organizer-pending.ts\n- Logic: getTeamLimit(teamId, LIMITS.MAX_PUBLISHED_COMPETITIONS) === 0\n- UI Result: Shows amber PendingOrganizerBanner with message about drafts only\n- Location: Banner in organizer/[competitionId]/(with-sidebar)/layout.tsx line 57\n- Capability: Can create draft competitions, cannot publish\n\n**STATE 3: APPROVED (Full Access via Limit)**\n- Condition: Team has HOST_COMPETITIONS feature AND MAX_PUBLISHED_COMPETITIONS limit = -1 (unlimited)\n- Check function: isApprovedOrganizer(teamId) in src/server/organizer-onboarding.ts\n- Logic: Has approved organizerRequestTable record\n- Capability: Full access to create and publish public competitions\n\n### Key Functions for Port\n\n1. Layout Gate Pattern (organizer/layout.tsx): getUserOrganizingTeams() returns empty array means no access\n\n2. Pending State Check: isTeamPendingOrganizer checks MAX_PUBLISHED_COMPETITIONS === 0\n\n3. Organizing Teams Filter: Requires both MANAGE_PROGRAMMING permission AND HOST_COMPETITIONS feature\n\n### Onboarding Flow\n\nsubmitOrganizerRequest: Grants HOST_COMPETITIONS + sets limit=0 + creates pending request\napproveOrganizerRequest: Updates request status + sets limit=-1\nrejectOrganizerRequest: Updates request status + optionally revokes feature\n\n### Config Constants\n\nFEATURES.HOST_COMPETITIONS = host_competitions\nLIMITS.MAX_PUBLISHED_COMPETITIONS = max_published_competitions\nValues: 0 = pending, -1 = unlimited","created_at":"1767208639890.0"}
{"id":"6e77ba6a-be13-4c3e-b520-6770a0b77e39","information":"WODsmith E2E test for registration with waiver signing: Created comprehensive Playwright test covering athlete registration flow with required waiver signing. Key patterns: (1) Use test.skip() when seeded competition data not available to prevent test failures, (2) Waiver signing flow uses WaiverSigningStep component with agreement checkboxes that must be checked before continue button enables, (3) Tests should verify button disabled state before waiver signing and enabled after, (4) WaiverViewer component displays Lexical JSON content in prose container, (5) Multiple waivers are displayed in separate border-2 cards, (6) Registration flow steps: select division -> fill details -> sign waivers -> payment/success. Test uses unique timestamps for isolation, follows existing auth fixtures pattern (loginAsTestUser), and includes 5 test cases covering happy path, waiver display, required signatures, multiple waivers, and form preservation.","created_at":"1766442215817.0"}
{"id":"6eff8a83-2692-41bb-ac9a-4a7010637005","information":"TanStack Start migration master checklist consolidation: When consolidating audit findings from multiple agents, create a dedicated \"Audit Findings\" section BEFORE the main content to document all corrections transparently. This provides traceability and prevents confusion when numbers change significantly. Key pattern: (1) Executive summary with corrected totals, (2) Per-audit findings with root cause analysis, (3) Summary table showing before/after for all major metrics. In WODsmith case: 5 audits revealed +24 routes (89→113), Settings/Admin doubled due to dual routing pattern, TanStack log functions exceeded Next.js (7 vs 5), and undocumented features (Gym Scheduler AI). Always update both overview tables AND detailed sections to maintain consistency.","created_at":"1766531264226.0"}
{"id":"717f196d-d0a2-404a-a4ee-a83dda7e6820","information":"WODsmith judge components type fixes: 1) Lucide icons don't accept 'title' prop, use 'aria-label' instead for accessibility. 2) getAssignmentsForVersion in judge-assignments.ts has server-side type mismatch - returns raw DB query with 'membership' but typed as JudgeHeatAssignment which expects 'volunteer' property. Needs type assertion workaround. 3) TypeScript doesn't narrow array[0] access even with .length check - use optional chaining. 4) ZSA useServerAction returns [data, err] where data is the handler return value { success, data: T }, so access nested data with data.data.property. 5) Session userId available via useSessionStore((state) => state.session?.userId).","created_at":"1766093833599.0"}
{"id":"71eb4d37-5a6f-4361-ac8e-9796503efab4","information":"GitHub Actions CI workflow for Turborepo monorepos: Use actions/cache/save in build job with key turbo-${{ github.sha }}, then actions/cache/restore in dependent jobs with same key. This ensures Turbo's incremental build cache is shared across jobs without rebuilding. The sha-based key prevents cache pollution between different commits. Jobs that need build artifacts (test, typecheck) should have 'needs: build' dependency. Lint can run standalone without build artifacts.","created_at":"1766269974164.0","tags":"github-actions,turborepo,ci,caching,monorepo"}
{"id":"72bea317-d610-4f36-a8b2-ea84779536c6","information":"TanStack Start schedule-page-client migration: The orchestrator component is a thin coordination layer (125 lines) that manages shared state between VenueManager and HeatScheduleManager. Key pattern: useState hooks for venues/heats with useCallback for handlers that propagate changes. When venue updates, must also update heats that reference that venue. Import paths use @/foo (not ~/foo). Tests use createTestWorkout factory with full workout schema (scheme as string like 'time-with-cap', not object). Multiple elements on page require getAllByText/getAllByRole for testing.","created_at":"1766700559470.0"}
{"id":"741bbf9f-17cd-4d99-94ae-71e7f9962ed8","information":"WODsmith volunteer availability filtering pattern: Added three helper functions for filtering volunteers by schedule availability (morning/afternoon/all_day). Key pattern: getVolunteerAvailability extracts from metadata, isVolunteerAvailableFor checks compatibility (all_day matches both, null metadata = backwards compatible), filterVolunteersByAvailability filters arrays by time slot. All functions handle null/undefined gracefully for backwards compatibility. Used in judge assignment UI to show only available volunteers for each heat.","created_at":"1766171476045.0","metadata":"{\"bead\":\"thewodapp-e6o.4\",\"file\":\"apps/wodsmith/src/server/volunteers.ts\",\"testing\":\"apps/wodsmith/test/server/volunteers.test.ts\"}"}
{"id":"7462f818-cc8a-4c72-8ae3-8163b17b1f90","information":"--information","created_at":"1766189648147.0","metadata":"{\"project\":\"wodsmith\"}","tags":"nextjs,react,conditional-rendering,wodsmith,volunteers,ui-patterns"}
{"id":"749417ca-69e4-4c19-800a-4450f82e547b","information":"WODsmith EventDefaultsEditor component pattern: Created inline editor for event-level judge rotation defaults. Component uses save-on-change pattern (no explicit save button), displays effective values with fallback to competition defaults, and shows override status text. Follows rotation-settings-form.tsx pattern: individual async handlers for each field, toast notifications, loading states with Loader2 icon. Uses LANE_SHIFT_PATTERN enum and LaneShiftPattern type from @/db/schemas/volunteers. Props include both event-specific nullable values and competition defaults for fallback display.","created_at":"1766012269516.0","metadata":"{\"type\":\"pattern\"}","tags":"component,inline-editing,judge-rotation,wodsmith"}
{"id":"79b40978-6d76-4d45-a8b7-464e2555db0a","information":"WODsmith InvitedVolunteersList component pattern: Successfully created table component with clipboard functionality. Key patterns: (1) Use typeof window !== undefined check before accessing window.location.origin for SSR compatibility, (2) State management for copiedToken with setTimeout to reset feedback after 2 seconds, (3) Badge variant mapping - use secondary for pending (yellow), default for success/accepted (green), destructive for expired/error (red), (4) Import formatDate from utils/format-date-client for client components, (5) Type-safe role formatting with ROLE_TYPE_LABELS Record type and type assertion for dynamic lookups, (6) Empty state Card with CardHeader/CardDescription for zero data UX. Toast from sonner for clean feedback. Shadcn components Table, Badge, Button, Card work seamlessly together.","created_at":"1766189426957.0"}
{"id":"7b42d0a9-1fd5-40b5-941f-5bb90bc29a27","information":"Next.js route groups for public/protected separation pattern:\n\nWhen a route under a protected layout needs to be publicly accessible (e.g., onboarding page in organizer routes):\n1. Create two route groups at the same level: (group-public) and (group-protected)\n2. Both groups can have the same URL path inside them (e.g., organizer/) because route groups don't affect URL\n3. Move public routes to public group with a simple layout (no auth check)\n4. Move protected routes to protected group with auth layout\n5. Update all imports that referenced old paths to include the route group name\n6. Use git mv to preserve file history when moving\n\nKey gotcha: If the protected layout had exception logic to allow certain routes through, remove it after moving to route groups - the separation is now structural, not conditional.","created_at":"1767035855347.0"}
{"id":"7c4debb0-c518-4928-98ef-d4785ea3d352","information":"Vitest workspace configuration for monorepo with turbo: Created vitest.workspace.ts at repo root using defineWorkspace() with glob patterns for apps/packages. Each package needs its own vitest.config.ts with test.name property for labeled output. Workspace enables pnpm test to run all tests with package labels like |@repo/test-utils| and |wodsmith|. Turbo caching works when test task has proper inputs (src/**, test/**, vitest.config.*, tsconfig.json) and outputs (coverage/**). Key insight: workspace config uses glob patterns, not explicit paths - this auto-discovers new packages without config changes.","created_at":"1766266800265.0","tags":"vitest,monorepo,turbo,workspace,testing,configuration,caching"}
{"id":"7ccf7236-13fe-4b6d-96e5-f314fe1f574a","information":"WODsmith judge rotation schema implementation: Created competitionJudgeRotations table in volunteers.ts with fields for competitionId, trackWorkoutId, membershipId, startingHeat (1-indexed), startingLane (1-indexed), heatsCount, laneShiftPattern (enum: stay/shift_right/shift_left), and notes. Added LANE_SHIFT_PATTERN constant. Added defaultHeatsPerRotation (default: 4) and defaultLaneShiftPattern (default: 'stay') config columns to competitions table. Pattern follows existing Drizzle conventions: CUID2 IDs with createJudgeRotationId(), commonColumns for timestamps, proper foreign key cascades, composite indexes for efficient queries. Migration: 0059_add_judge_rotations.sql. Relations defined for bidirectional access (competitions->judgeRotations, trackWorkouts->judgeRotations, teamMembership->judgeRotations).","created_at":"1765991762570.0"}
{"id":"7cd0de4c-3420-4240-8ecc-479928b44da6","information":"WODsmith TanStack migration audit finding: getTeamProgrammingTracksFn queries teamProgrammingTracksTable (subscription table), not ownership. Returns ALL subscribed tracks (owned + 3rd party public), not just team-owned tracks. Function name is misleading - should be getTeamSubscribedTracksFn. This means TanStack HAS subscription read capability but lacks write actions (subscribe/unsubscribe). Impact: Migration doc incorrectly stated \"No subscription system\" when it actually has read-only subscriptions.","created_at":"1766530538859.0"}
{"id":"7e2c7796-e773-41f9-9229-5302d63f3916","information":"WODsmith waiver server function testing pattern: Use FakeDrizzleDb from @repo/test-utils for mocking Drizzle ORM queries. Key technique: When testing functions that call other server functions internally (like getWaiverSignaturesForUser calling getCompetitionWaivers), mock db.query.tableName.findMany directly via mockDb.registerTable() then access the mock: mockDb.query.waiversTable.findMany.mockResolvedValueOnce(data). This avoids interference between nested function calls. Mock autochunk from @/utils/batch-query to simplify testing - just call the callback with the full array. Follow TDD red-green-refactor: write failing test, make it pass, refactor. Arrange-Act-Assert pattern keeps tests readable.","created_at":"1766437996062.0"}
{"id":"80a32373-f8a7-4356-9589-e28d60255740","information":"WODsmith event rotation defaults implementation: Added updateEventRotationDefaults server function to update defaultHeatsCount and defaultLaneShiftPattern on trackWorkoutsTable. Created updateEventDefaultsAction server action wrapping the function. Modified getRotationsForEvent to return both rotations array and eventDefaults object containing defaultHeatsCount and defaultLaneShiftPattern. Updated createJudgeRotation to inherit laneShiftPattern from event defaults (if not provided as param), then fall back to competition defaults, then STAY constant. All functions use MANAGE_COMPETITIONS permission consistent with other judge rotation operations. Pattern: event-level defaults take precedence over competition-level defaults.","created_at":"1766012642007.0"}
{"id":"8644614e-648f-4afb-8b0b-c5b64cc3bd6b","information":"WODsmith TanStack migration test coverage audit findings (2025-12-24): 39 settings/admin routes require ~52 integration tests and 6 E2E spec files. Current test coverage: only Programming routes (~80% covered) and Organizer Requests have tests. CRITICAL gaps: Passkeys/WebAuthn (requires Playwright CDP mock), FullCalendar scheduling (requires DOM interaction tests), Entitlements admin (business-critical). WebAuthn testing approach: use page.context().cdp(WebAuthn.enable) in Playwright. FullCalendar testing: use page.locator(.fc-event) for events, page.dragAndDrop() for drag-drop. Dual routing pattern (explicit teamId vs active team context) must be tested identically. Testing Trophy distribution: E2E for scheduling/entitlements/passkeys, Integration for most action files, Unit only for permission helpers.","created_at":"1766641656691.0"}
{"id":"87a2868a-b2c8-4f45-939d-5676c880d051","information":"Competition Platform Test Coverage Audit (Dec 2024): WODsmith competition platform has strong existing server-side test coverage (~200+ tests) covering: leaderboard ranking with tie detection (1513 lines), sponsors CRUD (47 tests, 1070 lines), volunteers/availability (918 lines), judge rotation utils (735 lines), Stripe Connect OAuth (631 lines), and comprehensive scoring library (9 test files). MISSING: E2E tests for registration→payment→success flow (revenue critical), integration tests for heat scheduling drag-and-drop (15+ components), action layer tests for 11 action files. Before migrating competition routes to TanStack Start, must create: e2e/compete/registration.spec.ts, test/integration/compete/heat-scheduling.test.ts, test/actions/competition-actions.test.ts. Existing factory functions in @repo/test-utils but need createCompetition, createDivision, createHeat, createScore factories.","created_at":"1766641626904.0"}
{"id":"893144e0-4a01-4d59-ab0a-1228160eb386","information":"WODsmith TanStack Start VenueManager component pattern: Implemented a CRUD component for competition venues with TDD approach. Key patterns used:\n\n1. Component Props Interface: Uses optional callback props (onVenueCreate, onVenueUpdate, onVenueDelete) for controlled mode, falls back to internal useState when callbacks not provided. This enables both controlled (parent manages state) and uncontrolled (component manages state) usage.\n\n2. Server Function Integration: Uses TanStack Start's createServerFn pattern. Call signature is `functionFn({ data: {...} })` NOT `functionFn({...})`. The server functions return `{ venue }` or `{ success: true }`.\n\n3. Dialog Pattern: Uses Radix Dialog via shadcn/ui. Separate dialogs for Create and Edit operations. Edit dialog state controlled by `editingVenue` state (null = closed, venue object = open with that venue's data).\n\n4. Test Mocking Pattern: Mock server functions with vi.mock at module level, then use vi.fn() for individual function mocks. Pattern: `vi.mock('@/server-fns/venue-fns', () => ({ createVenueFn: (args) => mockCreateVenueFn(args) }))`. This allows per-test mock configuration.\n\n5. Skeleton Component: Simple pattern with Card + Skeleton components from shadcn/ui. Use data-testid=\"venue-skeleton-card\" for test assertions. Skeleton uses animate-pulse class.\n\n6. Form Validation: Button disabled state for validation (`disabled={!newVenueName.trim()}`) is simpler than form validation libraries for basic required field validation.\n\n7. Delete Confirmation: window.confirm() for delete confirmation, mocked in tests with vi.spyOn(window, 'confirm').mockReturnValue(true/false).","created_at":"1766644473813.0"}
{"id":"8af7aa54-f2cb-44e2-822c-604afc80459b","information":"TanStack Start route integration pattern for organizer schedule page: The route uses getRouteApi() to access parent route loader data (competition object with organizingTeamId, startDate). The loader fetches competition via dynamic import, then parallel fetches all schedule data (venues, heats, events, divisions, registrations). For registrations with user/division relations, use getOrganizerRegistrationsFn instead of basic getCompetitionRegistrationsFn. The component passes all data to SchedulePageClient orchestrator which manages state coordination between VenueManager and HeatScheduleManager.","created_at":"1766701063483.0"}
{"id":"8b77bd47-4f22-431d-9ea0-8aa0856e0b38","information":"UBS JavaScript scanner false positive: JSX props like id=title or value={state} are flagged as Global variable assignments but they are actually JSX attributes not global pollution. This is a known limitation of the regex-based detection in UBS. Real global pollution would be assignments without const/let/var like myVar = 123 in global scope. Safe to ignore these warnings in React/Next.js components.","created_at":"1766382823425.0"}
{"id":"8ba7937e-b0d1-4854-8f7a-1f830fef978a","information":"WODsmith PublishRotationsButton pattern: Created reusable confirmation dialog component using AlertDialog from shadcn/ui. Pattern: 1) useServerAction hook for publishRotationsAction 2) Local state for notes and dialog open state 3) AlertDialog with trigger button, showing coverage summary, optional notes textarea, and confirmation 4) Success toast shows version number and assignment count 5) onPublishSuccess callback for parent refresh. Component accepts teamId, trackWorkoutId, rotationsCount, coverage stats, hasActiveVersion, nextVersionNumber props. Disabled when rotationsCount=0.","created_at":"1766013947865.0"}
{"id":"8c6ddbce-768c-463c-b7e7-6447ab55b64c","information":"WODsmith sponsor server testing pattern: When testing server functions that use .orderBy() in the query chain, mock the orderBy method instead of where. The FakeDrizzleDb chainable mock requires that terminal methods (like orderBy) be mocked with mockResolvedValueOnce to return the final data. Example: const orderByMock = mockDb.getChainMock().orderBy as any; orderByMock.mockResolvedValueOnce([data]). This ensures the full query chain (select → from → where → orderBy) works correctly. If you mock 'where' to return data directly, it breaks the chain and orderBy becomes undefined.","created_at":"1766616931137.0"}
{"id":"8cda9fb2-7d2c-43a6-b0ac-c71fd29e31b2","information":"Commerce action test patterns for WODsmith - TDD characterization tests:\n\n1. Mock structure for commerce actions:\n   - Mock @/utils/auth (requireVerifiedEmail)\n   - Mock @/utils/team-auth (requireTeamPermission) \n   - Mock @/utils/with-rate-limit to bypass rate limiting in tests\n   - Mock @/server/commerce functions (getRegistrationFee, buildFeeConfig, calculateCompetitionFees)\n   - Mock @/db (getDb) with query builders returning test data\n\n2. Pattern for testing actions with permission checks:\n   - First verify happy path with proper mocks\n   - Then test null session rejection\n   - Then test permission rejection via mocked requireTeamPermission throwing\n\n3. Database mock pattern for action tests using vi.mocked(getDb).mockReturnValue with nested query objects\n\n4. Test categories implemented: permission tests, validation tests, happy path, edge cases (zero fees, max fees, null division labels)\n\n5. Reference: apps/wodsmith/test/actions/commerce.action.test.ts (28 tests covering 4 actions)","created_at":"1766643278820.0"}
{"id":"8d64b7f0-5c90-4b53-ad13-38c108640655","information":"WODsmith test pattern: When mocking @repo/zsa-react useServerAction for components that call execute().then(), the mock MUST return a promise. Pattern: vi.fn(() => ({ execute: vi.fn().mockResolvedValue([{ success: true, data: [] }]), isPending: false })). Without mockResolvedValue, execute() returns undefined and .then() fails with \"Cannot read properties of undefined (reading 'then')\". Also ensure all server actions imported by hooks are mocked - check the _utils/ hooks for their imports, not just the component itself.","created_at":"1766273845317.0","tags":"testing,vitest,mocking,zsa,react,async"}
{"id":"8f9d4bfc-1586-4c78-9949-7ed02cc4a5bb","information":"WODsmith rotation-overview integration pattern: Extended RotationOverview component to show unpublished changes warning and publish button. Added props: teamId, trackWorkoutId, hasActiveVersion, nextVersionNumber, onPublishSuccess. Computed hasUnpublishedChanges = rotations.length > 0 && !hasActiveVersion. Shows Alert when hasUnpublishedChanges. Placed PublishRotationsButton in flex container next to rotation count badge. Parent passes organizingTeamId and selectedEventId to enable publishing.","created_at":"1766013955045.0"}
{"id":"911e8e3e-661f-4842-a864-4ab80acd974c","information":"TanStack Start route pattern in WODsmith: Child routes under $competitionId use parentRoute.useLoaderData() at render time to access competition data from parent layout. The child route's loader should NOT call the parent loader - instead fetch data directly using params.competitionId. For data requiring organizingTeamId, first fetch competition via getCompetitionByIdFn then use the teamId for subsequent calls. Use Promise.all for parallel data fetching in loaders.","created_at":"1766698585115.0"}
{"id":"9181405f-ff6a-429d-ac56-6ce0fa40a27d","information":"WODsmith heat-schedule-manager individual heat dialog: Added smart defaults and overlap validation. Key implementation details:\n1. Added `overlapWarning` state to track conflicts when creating individual heats\n2. Added `checkForOverlaps` callback that uses `detectOverlaps` from schedule-utils with `allCompetitionHeats` (not just current event heats)\n3. Updated `handleVenueChange` to use `getNextAvailableSlot` for smart default times across ALL events\n4. Added `handleTimeChange` and `handleDurationChange` functions that trigger overlap detection\n5. Added overlap warning UI with AlertCircle icon and disabled Create Heat button when conflicts exist\n6. Removed the old `getNextHeatTime` function which only looked at current event heats\nThe bulk create dialog in the same file was already updated by another agent with similar overlap detection via `checkBulkOverlaps`.","created_at":"1766901138059.0"}
{"id":"919b1755-bf74-4801-a62f-e2e73c93503b","information":"## Alchemy D1 Local Persistence Details\n\n### How D1 Works in Dev Mode\n\nDuring `alchemy dev`, D1 databases are emulated locally using SQLite. Alchemy manages this through its binding system, NOT through wrangler's miniflare setup.\n\nKey behaviors:\n1. **Local emulation is automatic** - Just declare `D1Database` in alchemy.run.ts\n2. **State persisted in `.alchemy/`** - Resource metadata tracked per stage\n3. **Data persists between dev restarts** - Local SQLite maintained by Alchemy\n\n### Using Remote D1 in Development\n\nFor scenarios requiring real data (staging, debugging prod issues):\n\n```typescript\nconst db = await D1Database(\"app-db\", {\n  dev: { remote: true } // Bypasses local emulation, uses real Cloudflare D1\n});\n```\n\n**When to use remote:**\n- Testing against production-like data\n- Debugging issues that don't reproduce locally\n- Running migrations against actual D1\n\n**When to use local (default):**\n- Normal development\n- Running tests\n- Offline work\n\n### Migration Workflow with Drizzle + D1\n\n1. Define schema in `src/schema.ts`\n2. Configure drizzle.config.ts with `dialect: 'sqlite'`\n3. Run `bun run db:generate` to create migrations\n4. Alchemy auto-applies migrations via `migrationsDir` option\n\n```typescript\nconst db = await D1Database(\"my-db\", {\n  name: \"my-db\",\n  migrationsDir: \"./migrations\", // Alchemy runs these on deploy\n  migrationsTable: \"drizzle_migrations\",\n});\n```\n\n### Stage-Based Database Isolation\n\nUse Alchemy stages to isolate databases per environment:\n\n```typescript\nconst stage = process.env.STAGE ?? \"dev\";\n\nconst app = await alchemy(\"my-app\", {\n  stage, // e.g., \"dev\", \"staging\", \"prod\"\n});\n\n// Database name includes stage\nconst db = await D1Database(\"my-db\", {\n  name: `my-db-${stage}`,\n});\n```\n\nState stored separately: `.alchemy/my-app/dev/`, `.alchemy/my-app/staging/`, etc.\n\n### Important: No wrangler.jsonc Required\n\nUnlike traditional Cloudflare development:\n- NO `wrangler.jsonc` d1_databases config needed\n- NO `wrangler d1 create` commands\n- Alchemy provisions D1 automatically on `alchemy deploy`\n- Local dev emulates without Cloudflare API calls\n\n### Gotchas\n\n1. **D1 100 parameter limit still applies** - Use chunking for `IN` clauses\n2. **No transactions in D1** - Same limitation as production\n3. **Local SQLite behavior matches D1** - Good for testing\n4. **State is per-stage** - Switching stages means different local databases","created_at":"1767044104247.0"}
{"id":"926a8129-6a22-4d6e-82a5-29190da9cbe5","information":"WODsmith RotationEditor refactor: Successfully removed laneShiftPattern from form schema and converted it to a required prop (eventLaneShiftPattern: LaneShiftPattern). Also added eventDefaultHeatsCount optional prop. Key changes: 1) Removed FormField for lane shift pattern selection, 2) Updated all preview calculations and server action calls to use prop instead of form value, 3) Defaulted heatsCount to eventDefaultHeatsCount with Math.min(4, maxHeats) fallback, 4) Added eventLaneShiftPattern to useEffect dependencies where used. This pattern is useful when moving event-level configuration from individual rotation settings to parent component props.","created_at":"1766013324537.0"}
{"id":"95c736a6-e456-404e-b723-357bd8f0e340","information":"Adding test:coverage to Turborepo monorepo requires three steps: 1) Add script to root package.json (\"test:coverage\": \"turbo test:coverage\"), 2) Add script to workspace package.json (\"test:coverage\": \"vitest run --coverage\"), 3) Add task definition to turbo.json with dependsOn, inputs, and outputs matching the test task. The @vitest/coverage-v8 package must be installed and compatible with the vitest version (upgraded to v4.0.16). Coverage config in vitest-base.ts has enabled:false by default, which is correct - the --coverage flag enables it at runtime.","created_at":"1766273812084.0","tags":"turborepo,vitest,coverage,monorepo,testing"}
{"id":"95e378cd-54a5-4d9a-ae50-5dbad0a501f5","information":"FakeDatabase implementation for test-utils enforces D1's 100 SQL parameter limit. Located in packages/test-utils/src/fakes/fake-db.ts. Key design: enforceParameterLimit() method throws error if array length > 100, preventing bugs that only surface in production. Used in findByIds() to catch code that doesn't use autochunk() from @/utils/batch-query. TypeScript type issue: TSchema constraint requires Record<string, Record<string, unknown>> AND test schemas must explicitly extend this. Use 'as unknown as TSchema[K]' for insert/update return types to satisfy compiler. Pattern follows TDD: wrote 15 tests first, all passed on first implementation. Full test coverage: insert (auto ID + custom ID), findById, findMany (with/without predicate), findByIds (with limit enforcement), update, delete, reset, enforceParameterLimit.","created_at":"1766266065050.0","tags":"testing,fake-database,d1,parameter-limit,tdd,test-utils,drizzle,cloudflare"}
{"id":"96842a92-7a4a-4afa-9d2a-2f29591c3e65","information":"WODsmith test skill composition pattern: Created top-level test skill as router/composer for unit-test, integration-test, e2e-test child skills. Key design: (1) Testing Trophy ASCII art diagram for visual reference, (2) Decision tree routing to appropriate child skill based on what is being tested, (3) TDD Red-Green-Refactor as non-negotiable discipline with ASCII flow diagram, (4) Lean design under 150 lines - router focuses on decisions not implementation details. Success pattern: Skill description includes trigger words like test testing write tests TDD so it auto-loads on relevant queries. Links to child skills use skills_use syntax for easy invocation. Anti-patterns section prevents common mistakes. This pattern works well for hierarchical skill organization - one entry point that routes to specialized child skills.","created_at":"1766352732684.0","tags":"skills,testing,composition,router-pattern,wodsmith,tdd,testing-trophy"}
{"id":"9913a3b6-c5d1-4700-939e-7e44a0bd3908","information":"When adding new schema files in Drizzle ORM for WODsmith project: 1) Create schema file in src/db/schemas/ with table definitions, types, and relations. 2) Add ID generator to common.ts using pattern createTableNameId = () => prefix_${createId()}. 3) Export from src/db/schema.ts. 4) For cross-schema relations, define reverse relations in the new schema file to avoid circular dependencies (see volunteers.ts pattern). 5) Run pnpm db:generate --name migration-name from apps/wodsmith directory. Migration includes: table creation, indexes, foreign keys, and any ALTER TABLE changes for existing tables.","created_at":"1765950568591.0"}
{"id":"9a341b2d-8bcc-4488-831b-135cc4e13d70","information":"Alchemy IaC Environment Documentation Pattern: When documenting alchemy.run.ts files, structure JSDoc in this order: (1) @fileoverview with environment model overview (stage-based), CLI usage examples per environment, state management explanation, and configuration options table; (2) App initialization with @remarks for environment-specific behavior; (3) Each resource (D1Database, KVNamespace, R2Bucket, TanStackStart) with: purpose, key features as bullet list, environment-specific notes in @remarks, access patterns in code examples, @see links to Cloudflare docs; (4) Exported types with usage examples; (5) finalize() documentation. The stage-based model means each STAGE env var creates isolated resources with stage-prefixed names (e.g., wodsmith-db-dev, wodsmith-db-prod).","created_at":"1767114360621.0"}
{"id":"9b591a1a-2507-4bfe-b1a4-2086e82facfd","information":"TanStack Start server function testing pattern for WODsmith wodsmith-start app: When testing server functions that use Drizzle queries with `.limit(1)` at the end of the chain, use `mockChainWithLimit()` helper that calls `limitMock.mockResolvedValueOnce(values)`. This is needed because FakeDrizzleDb's chain mock returns the mock object for chaining, but we need `.limit()` to resolve to actual data. Don't use `whereMock.mockResolvedValueOnce()` when a subsequent `.limit()` call is expected, as it breaks the chain. For queries that end with `.where()` without `.limit()`, the chain is thenable so awaiting it works. The FakeDrizzleDb from @repo/test-utils is simplistic - complex multi-query tests may need explicit sortOrder/parameters to bypass auto-order logic that requires multiple DB queries.","created_at":"1766643974792.0"}
{"id":"9ccf3111-0a40-4612-9fed-69bd93cd6c6d","information":"## Athlete User Journeys in WODsmith\n\n### JOURNEY 1: Discovery to Registration Flow\n```\nPublic Landing → Competition Details → Register Page → Payment → Success\n                                          ↓\n                                    (if not logged in)\n                                          ↓\n                                    Sign In → Redirect back\n```\n\n**Key touchpoints**:\n1. `/compete/$slug` - Landing page with hero, registration CTA\n2. `/sign-in?redirect=/compete/$slug/register` - Auth gate\n3. `/compete/$slug/register` - Division selection, affiliate info\n4. Stripe Checkout (external) - Payment for paid divisions\n5. `/compete/$slug/register/success` - Confirmation, profile completion, team invites\n\n**States handled**:\n- Registration not yet open\n- Registration closed  \n- Already registered (redirects back)\n- Free vs Paid divisions\n- Individual vs Team registration\n\n### JOURNEY 2: Pre-Competition Preparation Flow\n```\nCompetition Page → Workouts Tab → Schedule Tab → My Schedule (if judge)\n       ↓\n View divisions\n       ↓\n Review movement standards\n```\n\n**Key touchpoints**:\n1. `/compete/$slug/workouts` - View announced workouts\n2. Division selector - Filter workout standards by division\n3. `/compete/$slug/schedule` - Find heat times\n4. `/compete/$slug/my-schedule` - View judging assignments (volunteers only)\n\n**Information needs**:\n- What movements are in each event?\n- What are the standards for my division?\n- When do I compete?\n- Where should I be?\n\n### JOURNEY 3: Competition Day Flow\n```\nCheck Schedule → Find Heat → Compete → Check Leaderboard → Next Event\n                                ↑\n                         Volunteer:\n                    View Judging Rotation\n```\n\n**Key touchpoints**:\n1. `/compete/$slug/schedule` - Confirm heat time\n2. `/compete/$slug/my-schedule` - Judges view rotations\n3. `/compete/$slug/leaderboard` - Check standings after events\n4. `/compete/$slug/workouts` - Review next event standards\n\n**Mobile-first considerations**:\n- Quick access to heat schedule\n- Easy division filtering on leaderboard\n- Collapsible workout details\n\n### JOURNEY 4: Volunteer Application Flow\n```\nFind Competition → Volunteer Tab → Submit Form → Wait for Approval → View Schedule\n                                                        ↓\n                                               (If already has account)\n                                                        ↓\n                                               Auto-create membership\n```\n\n**Key touchpoints**:\n1. `/compete/$slug` - See volunteer opportunity\n2. `/compete/$slug/volunteer` - Public signup form\n3. Email notification (future) - Approval confirmation\n4. `/compete/$slug/my-schedule` - View assignments after approval\n\n**Form fields**:\n- Name, Email, Phone\n- Credentials (certifications)\n- Availability (morning/afternoon/all day)\n- Additional notes\n\n### JOURNEY 5: Post-Competition Flow\n```\nFinal Leaderboard → View Results → (End)\n       ↓\n  Download certificate (future)\n       ↓\n  View personal stats (future)\n```\n\n**Current state**: Basic leaderboard viewing\n**Future enhancements**: Result certificates, PR tracking, competition history","created_at":"1767131482303.0"}
{"id":"9de98dec-5c75-48f6-9e69-f72e1a1874c9","information":"WODsmith transcript synthesis pattern: Created comprehensive client-pain-points.md and decisions.md from processed meeting transcripts. Structure: By Category tables with source/client/date, By Client sections with context and top pains, Cross-Cutting Themes with roadmap priority (🔥 for high-frequency). Decisions organized by Architecture/Product/Business with context column explaining WHY. Key patterns: shift-based filtering (both clients), judge credentials (both clients), backend operations gap (core differentiator), progressive enhancement philosophy. Files link back to source transcripts for traceability.","created_at":"1766163845181.0"}
{"id":"a077227e-c876-476d-bc2c-4a9bb2667bd6","information":"Judge scheduling queries updated for versioned assignments in WODsmith: getJudgeHeatAssignments now accepts optional versionId parameter, defaults to finding active version for the event via judgeAssignmentVersionsTable where isActive=true. Returns empty array if no active version exists (nothing published yet). Updated all references from competitionHeatVolunteersTable to judgeHeatAssignmentsTable. Added JudgeHeatAssignment type properties: versionId (string|null) and isManualOverride (boolean). Pattern: find active version first, then filter assignments by versionId using and() with inArray for batched heat queries.","created_at":"1766013989323.0"}
{"id":"a255854d-113c-4eb5-9fbb-ee7caa337d91","information":"WODsmith rotation timeline heat times and availability filter implementation: Added two features to rotation-timeline.tsx:\n\n1. **Heat Time Display**: Modified grid from 2-row header (heat numbers only) to 3-row header (heat numbers + times + lanes). Changed gridTemplateRows from `40px repeat(${laneCount}, 40px)` to `40px 24px repeat(${laneCount}, 40px)` to accommodate thin 24px time row. Shows scheduledTime formatted with toLocaleTimeString({ hour: 'numeric', minute: '2-digit' }) or '--' if null. Required changing props from `heatsCount: number` to `heatsList: HeatInfo[]` where HeatInfo = { heatNumber, scheduledTime }.\n\n2. **Availability Filter**: Added ToggleGroup with options: All, Morning, Afternoon, All Day. Filter logic: 'all' shows all, 'morning' shows morning OR all_day, 'afternoon' shows afternoon OR all_day, 'all_day' shows ONLY all_day. Created filteredRotationsByVolunteer useMemo that maps judgeAvailabilityMap from availableJudges. Required adding `availability?: VolunteerAvailability` to JudgeVolunteerInfo type in server/judge-scheduling.ts and mapping it from metadata in getJudgeVolunteers.\n\nNote: ToggleGroup component in this project uses `options` prop (array of {value, label}), NOT ToggleGroupItem children like Radix.","created_at":"1766188851208.0"}
{"id":"a32b7a8f-636a-489f-ba11-4cef7a0801db","information":"WODsmith rotation-timeline volunteer grouping implementation: Successfully transformed rotation-timeline.tsx to use MultiRotationEditor with grouped volunteer list. Key patterns: 1) Group rotations by membershipId using Map, 2) Collapsible volunteer sections with ChevronLeft icon, 3) Multi-block preview cells with blockIndex for color differentiation, 4) Block-specific colors using BLOCK_COLORS array with modulo indexing, 5) Active block tracking for cell click targeting, 6) Batch delete using deleteVolunteerRotationsAction with direct delete query. Critical: MultiPreviewCell extends PreviewCell with blockIndex field, preview cells rendered with per-block colors, volunteer header shows aggregate heat ranges and rotation count, expanded section shows individual rotations with delete buttons.","created_at":"1766081523064.0"}
{"id":"a36063f6-9334-441e-ae90-0181835379ad","information":"WODsmith volunteer signup refactoring: Changed createVolunteerSignup in src/server/volunteers.ts to create team_invitation instead of placeholder user+membership. Return type changed from TeamMembership to TeamInvitation. Duplicate check now queries teamInvitationTable instead of checking teamMembershipTable metadata. Invitation metadata stores VolunteerMembershipMetadata with status: \"pending\". Token generated with crypto.randomUUID(). expiresAt set to 1 year (these don't expire like regular invites). invitedBy is null (will be set on approval). This prevents creating passwordHash: null users that can't log in.","created_at":"1766119375950.0"}
{"id":"a64a0893-f183-43a0-949a-645179ee9248","information":"semantic-memory_find compact rendering implementation: Modified memory-tools.ts to use formatMemoryResults from result-formatter.ts. Key changes: (1) Import formatMemoryResults and MemoryResult from result-formatter, (2) Added calculateDecayPercent() using 90-day half-life formula 0.5^(age/90)*100, (3) Added calculateAgeDays() to convert ISO timestamp to days, (4) Map FindResult.results to MemoryResult[] in execute function, (5) Return formatMemoryResults(memoryResults, query) instead of JSON. Output format: \"📚 Semantic Memory (N results for 'query'): [id] preview... (score: 0.57, decay: 91%, 12d)\"","created_at":"1767198840149.0"}
{"id":"a6695cdd-e1ff-4308-8c71-b2cceb49a04b","information":"Alchemy IaC - Core Concepts:\n\n1. **What is Alchemy**: TypeScript-first Infrastructure-as-Code for Cloudflare. Define infrastructure in `alchemy.run.ts`, deploy with `bun alchemy deploy`.\n\n2. **Project lifecycle**:\n```typescript\nimport alchemy from \"alchemy\";\nconst app = await alchemy(\"my-app\"); // Initialize with app name\n// ... define resources ...\nawait app.finalize(); // REQUIRED at end\n```\n\n3. **CLI commands**:\n- `bun alchemy login` - Authenticate with Cloudflare\n- `bun alchemy deploy` - Deploy all resources\n- `bun alchemy destroy` - Tear down all resources\n\n4. **State management**: Alchemy tracks state locally. Secrets encrypted with `ALCHEMY_PASSWORD` env var.\n\n5. **Type inference**: No codegen! Import types from `alchemy.run.ts`:\n```typescript\nimport type { worker } from \"../alchemy.run.ts\";\ntype Env = typeof worker.Env; // Fully typed bindings\n```\n\n6. **Available resources** (from alchemy/cloudflare):\n- Worker, TanStackStart\n- D1Database (with migrationsDir for auto-migrations)\n- KVNamespace, R2Bucket\n- DurableObjectNamespace\n- Queue (with dead letter support)\n- Zone, CustomDomain\n- Workflow\n- Assets\n\n7. **Bindings pattern**: All resources are bound via `bindings` object on Worker. Access via `env` parameter in handler.\n\n8. **Naming convention**: Resources get names like `${app}-${stage}-${id}` by default.","created_at":"1767043897254.0","tags":"alchemy,cloudflare,infrastructure-as-code,concepts,overview"}
{"id":"a6827a69-ad50-4094-a51b-fe98e6443775","information":"WODsmith integration testing pattern for Radix UI forms: Add ResizeObserver mock in beforeAll for Radix UI components that use size detection (like Select, Checkbox). Mock pattern: beforeAll(() => { global.ResizeObserver = class ResizeObserver { observe() {} unobserve() {} disconnect() {} } }). This is required in addition to the existing setup.ts mocks (scrollIntoView, hasPointerCapture, setPointerCapture, releasePointerCapture). The Radix UI react-use-size package requires ResizeObserver which does not exist in jsdom.","created_at":"1767034102907.0"}
{"id":"a7a02913-e763-4621-b671-2af93bc5b890","information":"WODsmith judge assignment publishing system: publishRotations() creates versioned snapshots of judge rotations. Each version materializes rotation patterns (startingHeat, heatsCount, laneShiftPattern) into individual judge_heat_assignments rows. Lane shift calculation: STAY = same lane, SHIFT_RIGHT = ((startingLane - 1 + i) % maxLanes) + 1, SHIFT_LEFT = ((startingLane - 1 - i + maxLanes * 100) % maxLanes) + 1. Uses autochunk for bulk inserts to respect D1's 100 param limit. Version management includes getActiveVersion, getVersionHistory, rollbackToVersion. Server functions use requireTeamPermission for MANAGE_COMPETITIONS. Actions follow ZSA pattern with createServerAction().input().handler().","created_at":"1766013824491.0"}
{"id":"a973d42e-d344-45f5-8f2f-fbcf4a496ba4","information":"When Drizzle Kit's `pnpm db:generate` gets stuck on interactive prompts (e.g., \"Is table X created or renamed?\"), use `pnpm drizzle-kit generate --custom --name MIGRATION_NAME` to create an empty migration file, then write the SQL manually. This bypasses the interactive prompt issue while maintaining migration tracking. The custom flag is documented in `drizzle-kit generate --help`.","created_at":"1766093993942.0"}
{"id":"ac78c1b4-32c3-4822-931a-c73b2f2a5da0","information":"Playwright E2E setup requires BOTH playwright and @playwright/test packages at MATCHING versions. Installing @playwright/test alone creates version mismatch error. Solution: ensure both packages are at same version. Playwright 1.57.0 is current stable as of Dec 2025.","created_at":"1766269095785.0"}
{"id":"ae06f4ac-45da-40a0-ad80-14d5a4ed97e0","information":"WODsmith rotation-timeline buffer zone visualization: Added visual indication of heat buffer zones when editing judge rotations. When editingVolunteerId is set, the coverageGrid calculates buffer zones (minHeatBuffer heats before and after each rotation) and marks empty cells as \"buffer-blocked\". Buffer cells are styled with amber/yellow border (bg-amber-500/20 border-amber-500/40 border-2) and show a tooltip explaining the buffer rule. The buffer zone is only displayed when a specific judge is being edited/added to prevent visual clutter. The implementation matches server-side validation logic in judge-rotations.ts which enforces bidirectional buffer checking.","created_at":"1766094950333.0"}
{"id":"ae5d6b80-f42d-44ca-9a20-35c77955c0d9","information":"TanStack Start router.invalidate() behavior: router.invalidate() alone marks the router cache as stale but does NOT automatically trigger a re-render with new loader data. After calling router.invalidate(), you must also navigate to trigger the loaders to actually re-run and update the component. Pattern: `await router.invalidate(); await router.navigate({ to: currentRoute })`. This is especially important for inline auth forms where you need the page to reflect the new authenticated state immediately after sign-in/sign-up. Without the navigation, the component will continue showing stale isAuthenticated=false even though the session cookie is set.","created_at":"1767224177989.0"}
{"id":"b0fa6649-81cc-4a85-85e9-f8008edf5042","information":"When creating ZSA server actions for WODsmith competition management:\n1. Use MANAGE_COMPETITIONS permission for organizer-only actions (volunteer role management, judge scheduling)\n2. Public read actions (getVolunteers, getAssignments) don't need permission checks\n3. Server functions receive getDb() call from actions, don't pass db from actions\n4. Always revalidatePath with competition ID: `/compete/organizer/${competitionId}/volunteers` or `/schedule`\n5. Use proper ID validation schemas: tmem_ for memberships, cheat_ for heats, chvol_ for volunteer assignments\n6. Follow consistent error handling pattern: try/catch with ZSAError propagation\n7. Import sorting: external packages (drizzle, next) → @repo → @/ paths (db, server, utils)\n8. For metadata updates, merge with existing metadata rather than replacing","created_at":"1765951135841.0"}
{"id":"b17ef611-d1e6-42b2-b36c-a0e8cc771414","information":"TanStack Start authentication migration from Next.js App Router: ZSA createServerAction converts to createServerFn({method: 'POST'}) with .inputValidator((data) => schema.parse(data)) instead of .input(schema). Handler receives {data} instead of {input}. Error handling uses plain Error instead of ZSAError. Session checks happen in route beforeLoad hook instead of server component. TanStack Start needs custom rate limiting implementation (no withRateLimit wrapper yet). Cookie management differs: Next.js uses cookies() from next/headers, TanStack needs equivalent API. Feature flags and KV store access patterns need TanStack-specific implementations.","created_at":"1766529330414.0","tags":"tanstack-start,nextjs,migration,authentication,zsa,server-actions"}
{"id":"b1bb93d0-0b68-4a87-b60b-12e1e8ff3fb6","information":"Executive summary synthesis pattern for multi-worker analysis swarms: Read all completed analysis files (6 workers, ~2,155 lines), extract cross-cutting patterns (10 patterns appearing in 3+ collections), identify strategic gaps (12 gaps with HIGH/MEDIUM/LOW impact ratings), create prioritized roadmap (3 phases: Launch/Post-Launch/Competitive Advantages with effort estimates). Key technique: Comparison table showing competitor vs our platform (227 articles vs 62 high-quality, 0 tax docs vs 8, etc). Format: Overview stats → What they do well → What's missing → Phased roadmap → Top 5 priorities → Metrics. This creates actionable documentation strategy from distributed worker outputs.","created_at":"1766354799032.0","tags":"swarm,synthesis,executive-summary,analysis,documentation,patterns,prioritization"}
{"id":"b235975b-b9ee-4fa1-89ec-2a8b89eef624","information":"WODsmith competition settings implementation pattern: Created settings page at /compete/organizer/[competitionId]/settings following pricing page pattern. Server action in competition-settings.action.ts uses withRateLimit wrapper from @/utils/with-rate-limit (NOT @/lib/rate-limiter) and requireVerifiedEmail from @/utils/auth (NOT @/lib/auth-server). Form component uses local useState for form state, toast notifications, and router.refresh() after successful save. Added Settings icon to competition sidebar navigation with proper sorting. Rotation settings include defaultHeatsPerRotation (1-10 Input) and defaultLaneShiftPattern (Select with LANE_SHIFT_PATTERN constants from @/db/schemas/volunteers). Used Card component for consistent UI with CardHeader/CardContent structure.","created_at":"1765992187652.0"}
{"id":"b28c4a8e-8676-4bdd-b269-1462733bfe1c","information":"Competition Corner help center actively blocks automated access with 403 Forbidden errors on fetch requests AND aggressive client-side routing redirects that prevent browser automation from accessing collection pages. Even direct URL navigation to collections (e.g., /collections/384899-i-m-an-athlete) gets redirected to random individual articles. Workaround: Use inference-based analysis from collection metadata and domain knowledge when direct scraping fails. For competition platform documentation analysis, focus on athlete vs organizer patterns: athletes need speed (deadline pressure), mobile-first workflows, task-focused content, and low tolerance for confusion due to high stakes (rankings/scores).","created_at":"1766354450227.0"}
{"id":"b2bc2ec3-d257-471c-b2b5-7a87b077ad51","information":"WODsmith organizer-onboarding test pattern: When testing getAllOrganizerRequests, the function calls getDb() once and uses that same db instance for two separate queries: (1) main request query with innerJoin chains, and (2) reviewer lookup query. The mock must use mockImplementation with a selectCallCount tracker to return different query chain shapes for each select() call. Pattern: createMockDbForGetAll(requests, reviewers) helper that returns different mock chains based on call count - first call returns innerJoin chain, subsequent calls return simple where() chain for reviewer lookup.","created_at":"1767033913621.0"}
{"id":"b405d469-29d2-4486-b9a9-f75049b96b80","information":"Customer.io cioIdentify debugging pattern (egghead-next project):\n\nROOT CAUSE DISCOVERY:\n1. **Subscriber loading requirements** - useCio hook only loads subscriber if:\n   - `cio_id` or `_cioid` cookie exists, OR\n   - `?cio_id=<id>` query param in URL, OR  \n   - User logged in with egghead token + has contact_id\n   \n2. **Silent API error handling** - `/api/cio/identify/[id].ts` has `.catch(() => {})` on PUT, swallowing all errors. Combined with always returning 200, this masks failures.\n\n3. **Disabled alerting** - `report-cio-api-error.ts` has inngest.send commented out, so no Slack alerts for CIO API failures.\n\nDEBUGGING APPROACH:\n- Check if subscriber loads (console.log subscriber in useEffect)\n- Check email templates for cio_id param in links\n- Check Vercel logs for API route calls\n- The page implementation pattern is CORRECT - problem is upstream (data loading or API errors)\n\nPATTERN: When cioIdentify \"doesn't work\", check:\n1. Is subscriber loading? (requires identifier in cookie/URL/auth)\n2. Is API actually succeeding? (errors may be swallowed)\n3. Is the email link formatted correctly?","created_at":"1767044876306.0"}
{"id":"b6046045-e5c6-4d98-8ee5-b2ac600a46e8","information":"--information","created_at":"1766268757522.0","tags":"playwright,e2e,auth,nextjs,testing-patterns"}
{"id":"bbcba07c-6674-466f-878a-a6869cf07152","information":"WODsmith Entitlement System Unit Test Patterns:\n\nThree entitlement states for competition hosting:\n1. NO ENTITLEMENT: Team lacks HOST_COMPETITIONS feature → hasFeature() returns false → redirect signal\n2. PENDING: Has HOST_COMPETITIONS BUT MAX_PUBLISHED_COMPETITIONS = 0 → isTeamPendingOrganizer() returns true → private-only + banner signal\n3. APPROVED: Has HOST_COMPETITIONS AND MAX_PUBLISHED_COMPETITIONS = -1 → isTeamPendingOrganizer() returns false → full access signal\n\nKey functions to test:\n- hasFeature(teamId, FEATURES.HOST_COMPETITIONS) - checks feature access\n- getTeamLimit(teamId, LIMITS.MAX_PUBLISHED_COMPETITIONS) - checks limit value\n- isTeamPendingOrganizer(teamId) - checks if limit === 0\n- getUserOrganizingTeams() - filters teams by MANAGE_PROGRAMMING permission AND HOST_COMPETITIONS feature\n\nMocking pattern for these tests:\n- Mock getDb() with query.teamTable.findFirst, query.planTable.findFirst, query.teamEntitlementOverrideTable.findFirst\n- Mock select().from().innerJoin().where() for feature/limit queries\n- For limit overrides, return {type: \"limit\", key: LIMITS.X, value: \"0\"|\"-1\"|\"N\"}\n- For feature overrides, return {type: \"feature\", key: FEATURES.X, value: \"true\"|\"false\"}\n\nTest file location: apps/wodsmith/test/server/entitlements-checks.test.ts","created_at":"1767209093110.0"}
{"id":"bc798a57-2400-4251-96df-e43f1e014696","information":"Fixed TypeScript errors in WODsmith judge rotation actions:\n1. Array access in nested loops (input.rotations[i], input.rotations[j]) can return undefined - TypeScript doesn't infer that loop bounds guarantee valid indices. Solution: Add explicit undefined checks with early continue.\n2. competitionJudgeRotationsTable does NOT have a teamId column - it only has competitionId, trackWorkoutId, membershipId. The membershipId already provides team isolation (memberships are team-specific). When deleting rotations, filter by membershipId + trackWorkoutId only.","created_at":"1766093450038.0"}
{"id":"bc8787d6-b8e2-4c8c-a79b-e303909be335","information":"## WODsmith Organizer User Journeys and Diataxis Documentation Map\n\n### USER JOURNEY 1: First-Time Organizer Flow\n**Goal:** Set up and run first competition\n\n**Step-by-Step Path:**\n1. Dashboard → Create Competition (new.tsx)\n2. Configure basic details → Set dates → Registration window\n3. Add Divisions (divisions.tsx) - Choose scaling group\n4. Add Events/Workouts (events/index.tsx) - Create workout list\n5. Configure Pricing (pricing.tsx) - Connect Stripe, set fees\n6. Publish Competition → Open Registration\n7. Monitor Registrations (athletes.tsx)\n8. Schedule Heats (schedule.tsx) - Before event day\n9. Recruit Volunteers (volunteers.tsx)\n10. Event Day: Enter Results (results.tsx)\n11. Post-Event: View Revenue (revenue.tsx)\n\n**Documentation Needed (TUTORIAL-focused):**\n- \"Your First Competition: Complete Setup Guide\" (umbrella tutorial)\n- \"Understanding Divisions and Scaling\" (explanation)\n- \"Setting Up Paid Registration\" (critical tutorial)\n\n---\n\n### USER JOURNEY 2: Event Day Management Flow\n**Goal:** Successfully run competition day operations\n\n**Pre-Event:**\n1. Verify heat schedule is complete (schedule.tsx)\n2. Confirm volunteer/judge assignments (volunteers.tsx)\n3. Publish judge rotations (judge-scheduling-container.tsx)\n\n**During Event:**\n1. Check athlete check-ins (athletes.tsx)\n2. Monitor heat timing (schedule.tsx)\n3. Enter scores by event/heat (results.tsx)\n4. Handle score corrections and special cases\n\n**Real-Time Decisions:**\n- DNF/DNS/DQ handling\n- Heat time adjustments\n- Judge rotation changes (version management)\n\n**Documentation Needed (HOW-TO focused):**\n- \"Event Day Checklist for Organizers\"\n- \"Entering Scores During Competition\"\n- \"Handling DNF, DNS, and Disqualifications\"\n- \"Managing Judge Assignments in Real-Time\"\n\n---\n\n### USER JOURNEY 3: Post-Competition Flow\n**Goal:** Wrap up competition and analyze results\n\n**Steps:**\n1. Finalize all scores (results.tsx)\n2. Review leaderboard accuracy\n3. Check revenue totals (revenue.tsx)\n4. Archive or edit competition details (edit.tsx, settings.tsx)\n\n**Documentation Needed:**\n- \"Post-Competition Checklist\"\n- \"Understanding Your Revenue Report\"\n\n---\n\n## DIATAXIS DOCUMENTATION MAP FOR ORGANIZERS\n\n### TUTORIALS (Learning-Oriented)\nTarget: New organizers, first-time users\n\n1. **Create Your First Competition** - End-to-end walkthrough\n   - Routes: new.tsx → divisions.tsx → events/index.tsx → pricing.tsx\n   - Outcome: Published competition with open registration\n\n2. **Schedule Judge Rotations** - Complex feature tutorial\n   - Routes: volunteers.tsx (JudgeSchedulingContainer)\n   - Concepts: Rotations, lane shifts, version management\n\n3. **Set Up Paid Registration** - Monetization tutorial\n   - Routes: pricing.tsx (Stripe integration)\n   - Prerequisites: Stripe account connection\n\n### HOW-TO GUIDES (Task-Oriented)\nTarget: Experienced organizers, specific tasks\n\n1. Configure competition divisions - divisions.tsx\n2. Add and edit events - events/index.tsx, events/$eventId.tsx\n3. Create heat schedule - schedule.tsx\n4. Manage athlete registrations - athletes.tsx\n5. Invite and manage volunteers - volunteers.tsx\n6. Enter competition scores - results.tsx\n7. Configure division-specific pricing - pricing.tsx\n8. Create a competition series - series/index.tsx, series/new.tsx\n9. Assign sponsors to events - sponsors.tsx\n10. Handle DNF/DNS/DQ entries - results.tsx\n11. Grant score input permissions - volunteers.tsx\n12. Edit competition after creation - edit.tsx\n13. Delete a competition safely - danger-zone.tsx\n\n### REFERENCE (Information-Oriented)\nTarget: Developers, technical users\n\n1. **Scoring Schemes and Types**\n   - For Time, AMRAP, Weight, Points\n   - Tiebreaker schemes\n   - Score validation rules\n\n2. **Division Settings Reference**\n   - Team sizes\n   - Scaling group structure\n   - Registration counts\n\n3. **Heat Schedule Structure**\n   - Venue configuration\n   - Lane management\n   - Time slots and transitions\n\n4. **Judge Rotation System**\n   - Version history\n   - Lane shift patterns (stay, shift_right)\n   - Heat coverage calculations\n\n5. **Fee Structure Reference**\n   - Platform fees\n   - Stripe fees\n   - Pass-through options\n\n6. **Server Functions API**\n   - competition-fns.ts functions\n   - competition-detail-fns.ts functions\n   - competition-heats-fns.ts functions\n   - competition-score-fns.ts functions\n\n### EXPLANATION (Understanding-Oriented)\nTarget: All users seeking deeper understanding\n\n1. **How Competition Scoring Works**\n   - Score types, rankings, tiebreakers\n   - Cross-divisional comparisons\n\n2. **How Judge Rotations Work**\n   - Lane shift patterns explained\n   - Coverage calculations\n   - Why versioning matters\n\n3. **How Heat Generation Works**\n   - Athlete assignment algorithms\n   - Division-based grouping\n   - Lane optimization\n\n4. **Understanding Competition Team Structure**\n   - Organizing team vs competition team\n   - Volunteer roles and permissions\n   - Team-based access control","created_at":"1767131504147.0"}
{"id":"bc8b49c1-9e35-480b-8587-cdaea4088563","information":"Stripe Connect action tests pattern for wodsmith: When testing server actions that wrap server functions, mock the underlying server functions (from @/server/stripe-connect) rather than Stripe SDK directly. Key mocks needed: requireVerifiedEmail, requireTeamMembership, requireTeamPermission from @/utils/team-auth, and the DB layer. Use createTestSession from @repo/test-utils/factories with appropriate permissions (EDIT_TEAM_SETTINGS for account management, ACCESS_BILLING for balance/dashboard). Also mock withRateLimit to pass through the inner function directly. Cookie mocking needed for OAuth flows via next/headers cookies.","created_at":"1766643255690.0"}
{"id":"bd0d2bbf-d205-4784-bca9-b754e314ca80","information":"WodSmith Start competition filtering by team: getOrganizerCompetitionsFn in competition-fns.ts filters competitions by organizingTeamId. The organizer dashboard route (/compete/organizer/index.tsx) uses getActiveTeamIdFn() to get the active team from cookie, then passes teamId to getOrganizerCompetitionsFn. Team switching is handled by TeamFilter component which updates the activeTeamId cookie, causing a route refresh with new competitions. Tests for this pattern are in apps/wodsmith-start/test/server-fns/competitions.test.ts and use FakeDrizzleDb from @repo/test-utils for mocking.","created_at":"1767210031071.0"}
{"id":"be3514d9-4f58-4074-a275-f9964e6d681d","information":"WODsmith Testing Infrastructure Validation: The testing-rig-integration-plan.md is 93% accurate. Key findings: (1) Current D1/Drizzle mock is NOT basic - it is a sophisticated 24-method chainable mock with thenable pattern, but lacks in-memory state. Plan FakeDatabase upgrade is correct. (2) 43 test files exist, plan said 40+. (3) Four domain-specific challenges NOT in plan: Cloudflare Workers env mocking for KV R2 D1, Lucia Auth session factory needed because 33-line mock repeated across tests, D1 100-param SQL limit not tested and autochunk usage not validated, multi-tenancy isolation not tested with no assertTenantIsolation helper. (4) Vitest 3.2.3 confirmed, Testing Library setup confirmed, Playwright not configured correct, no vitest.workspace.ts correct, no CI test pipeline correct. (5) Hidden patterns: server-only mocking via alias, layered test organization for actions components server lib, Turbo task dependencies. Priority 0 additions needed: FakeCloudflareEnv, createTestSession factory, FakeSessionStore, assertTenantIsolation helper, D1 param limit validation in FakeDatabase.","created_at":"1766211302067.0"}
{"id":"c1d427df-4c5f-4fbc-8224-2965c76b63c6","information":"WodSmith team context cookie testing patterns:\n\n1. **Mock Cookie Store Pattern**: Use an in-memory Map to simulate Next.js cookies() API with get/set/delete methods that return Promise.resolve() wrapping the mock.\n\n2. **Dynamic Import for Fresh Mocks**: Import modules dynamically in beforeEach to get fresh instances with mocks applied. Clear mockCookieStore before each test.\n\n3. **ZSA Error Testing**: ZSA errors are wrapped - use toMatchObject({ code: \"FORBIDDEN\", message: \"...\" }) instead of instanceof ZSAError.\n\n4. **Cookie Options Verification**: Test security flags (httpOnly, sameSite, path) via the options stored in the mock Map.","created_at":"1767209049628.0"}
{"id":"c5ce56e5-04db-4f0e-98fc-58521212d8fb","information":"WODsmith waiver status display implementation pattern: Created WaiverStatusBadge component with popover showing missing waivers. Badge shows green checkmark for complete, amber warning with count for pending. Added waiverSignatures relation to competitionRegistrationsRelations in competitions schema. Fetched waivers and signatures in parallel with Promise.all in page.tsx. Added optional waiver status filter (All/Complete/Pending) following same pattern as division filter - server-side searchParams, client-side useSearchParams + router.push. Filter only shows when required waivers exist. Client-side filtering logic checks if all required waivers are signed by comparing signedWaiverIds to required waiver IDs.","created_at":"1766383083480.0"}
{"id":"c893b287-1fdb-4920-9fea-5c46d4d4c22f","information":"WODsmith judge assignment version UI: Successfully implemented version selector dropdown for Published Assignments tab. Key patterns: 1) Fetch version history and active version in page.tsx parallel to other data. 2) Pass versionHistoryMap and activeVersionMap as props to container. 3) Auto-select active version with useEffect when event changes. 4) Show empty state (FileWarning icon) when no active version. 5) Version selector shows \"Version X - Published DATE (Active)\" format. 6) Rollback calls rollbackToVersionAction then fetches assignments for new version. 7) Manual override indicator uses Edit2 icon with orange-500 color. 8) Renamed \"Manual Assignment\" tab to \"Published Assignments\" to reflect versioned nature.","created_at":"1766014487066.0"}
{"id":"c8c7ff7d-ddd7-404d-9998-4072f3346e5c","information":"WODsmith volunteer availability display and filtering: Added availability badge to volunteer rows showing Morning/Afternoon/All Day based on VOLUNTEER_AVAILABILITY enum from metadata. Implemented availability filter dropdown in volunteer list using Select component. Badge displays below volunteer name alongside Pending badge when present. Filter dropdown placed in actions bar, filters by exact availability value from metadata.availability field. Uses getAvailabilityLabel helper for display labels and getAvailability helper for parsing metadata.","created_at":"1766171595924.0"}
{"id":"c95e9441-ebde-4d2c-bbe6-0f3e8eb819af","information":"TanStack Start environment variables for Stripe integration: VITE_ prefix replaces NEXT_PUBLIC_ for client-side vars (VITE_STRIPE_PUBLISHABLE_KEY, VITE_APP_URL). STRIPE_CLIENT_ID is required for Stripe Connect OAuth flow but was undocumented in the Next.js .env.example - it's used in stripe-connect/accounts.ts for Standard account OAuth. Default Vite port is 5173 (not 3000 like Next.js). The .dev.vars file is specific to Cloudflare Workers and overrides .env for wrangler dev.","created_at":"1766643126405.0"}
{"id":"caf3502a-a7ab-4ade-a880-4d1925109300","information":"WODsmith judge rotation server implementation: Created judge-rotations.ts with 8 core functions: CRUD operations (create/update/delete), query functions (getRotationsForEvent, getRotationsForJudge), coverage calculation (calculateCoverage, expandRotationToAssignments), and validation (validateRotationConflicts). Coverage calculation uses a grid-based approach to track heat×lane assignments, detecting gaps (uncovered slots) and overlaps (double-booking). Rotation expansion handles three lane shift patterns: stay (same lane), shift_right (increment lane), shift_left (decrement lane) with proper modulo wrapping. Validation checks for invalid heats/lanes and double-booking conflicts. Updated judge-scheduling.ts to add getJudgeOverview using rotation-based coverage % instead of simple judge count. Created judge-rotation-actions.ts with ZSA actions following pattern: validate conflicts before create/update, use MANAGE_COMPETITIONS permission, handle NOT_FOUND and CONFLICT errors explicitly.","created_at":"1765992143208.0"}
{"id":"cbbd3781-97b7-4756-9288-6b202a505c6b","information":"TanStack Start migration in WODsmith: Import alias is @/ NOT ~/. Despite TanStack conventions suggesting ~, the wodsmith-start project uses @/ for path aliasing (e.g., @/components/ui/badge). Check existing components in the target directory to confirm import patterns before porting. Component was in src/components/compete/organizer/ and test in test/components/compete/organizer/.","created_at":"1766698440835.0"}
{"id":"cd211a2d-aa36-4c52-a02f-ca6a58f1b1bc","information":"Playwright 1.55.0 configuration for Next.js 15 with Cloudflare Workers deployment: Use pnpm start (not next start) for CI webServer command since OpenNext build is required for production. Local dev uses pnpm dev. Configure blob reporter for CI to enable sharding with merge-reports. Use retain-on-failure for video/screenshot to save storage. The webServer timeout of 120_000ms is necessary for Next.js cold starts in CI. Playwright expects e2e/ directory by default with testDir config.","created_at":"1766268534473.0","tags":"playwright,nextjs,cloudflare,testing,ci,webserver,opennext"}
{"id":"cdbefec3-433e-42e3-a9ec-015c3e4a433c","information":"TanStack Start with @cloudflare/vite-plugin cloudflare:workers import error fix:\n\nPROBLEM: Vite build fails with \"Failed to resolve import 'cloudflare:workers'\" during client environment build.\n\nROOT CAUSE: The `cloudflare:workers` virtual module is only provided by @cloudflare/vite-plugin for the SSR environment (configured via `viteEnvironment: {name: 'ssr'}`). During client bundle creation, Rollup tries to resolve this import but can't.\n\nSOLUTION: Add `build.rollupOptions.external: ['cloudflare:workers']` to vite.config.ts:\n\nbuild: {\n  rollupOptions: {\n    external: ['cloudflare:workers'],\n  },\n}\n\nThis tells Vite/Rollup to externalize the cloudflare:workers import for client builds. The SSR build still resolves it correctly via the cloudflare plugin.\n\nCONTEXT: This issue appears when server-only database code (using cloudflare:workers for env bindings) gets bundled into the client build via module imports from route files. The fix keeps the import pattern intact while allowing both builds to succeed.","created_at":"1766702523817.0"}
{"id":"cffa53b2-1b3c-4298-88ea-298195bd32ca","information":"WODsmith volunteer admin UI: Added pending volunteer support to organizer volunteers page. Key implementation: 1) Extended VolunteerWithAccess interface with status field. 2) Added parseMetadata() helper that extracts status, signupName, signupEmail, signupPhone from membership metadata JSON. 3) Updated VolunteerRow to show \"Pending\" badge and Approve/Reject buttons for pending volunteers (status=\"pending\"). 4) Used updateVolunteerMetadataAction to flip status to \"approved\" or \"rejected\". 5) Updated VolunteersList to use Tabs component with All/Pending/Approved filters, showing badge counts. 6) For pending volunteers, display signupName/signupEmail from metadata instead of user fields (since they may not have accounts yet).","created_at":"1765953413040.0"}
{"id":"d01d2f98-56f5-4b5a-8616-8da9d4ed035b","information":"WODsmith volunteer management pain points from client demos: (1) No existing system handles volunteer scheduling (Basile: \"never seen one that does\"), (2) Credential tracking needed for appropriate heat assignment (L2 gymnastics, experience level), (3) Shift-based filtering critical (morning 8am-noon vs afternoon noon-end), (4) Judge rotation complexity (2 judges/lane ideal, rotate every 2 heats, ~30min rest periods), (5) Manual spreadsheet distribution to volunteers, (6) Lane-level too granular - heat-level sufficient with in-person coordination, (7) Progressive enhancement approach wins - nothing required but more data = more helpful.","created_at":"1766163284839.0","metadata":"{\"domain\":\"volunteer-management\",\"source\":\"cell-ru596g-mjd3vu4oerk\",\"clients\":[\"verdant\",\"canvas\"]}"}
{"id":"d025359c-89b5-4d0a-93c5-8067fd404f47","information":"WODsmith test expectations fix pattern: When component renders Event #X format but tests expect Day X format, the fix is to UPDATE TEST assertions, not component code. Component uses trackOrder with Event # prefix. This is the correct pattern for test maintenance - tests should match component behavior, not vice versa. Affected tests in scheduling-details.test.tsx lines 81-82, 294-296, 332-334.","created_at":"1766273809641.0"}
{"id":"d22ea57d-9be8-4c0a-b976-62a1036f8678","information":"WODsmith volunteer signup availability pattern: Added radio button group for volunteer availability (Morning, Afternoon, All Day) to signup form. Key points: 1) Import VOLUNTEER_AVAILABILITY from @/db/schemas/volunteers, 2) Add radio buttons with defaultChecked on ALL_DAY option, 3) Cast form data value to union type for type safety, 4) Update action schema with z.enum() and .default(), 5) Pass availability to createVolunteerSignup server function which stores in metadata. Schema allows optional availability field in VolunteerMembershipMetadata interface.","created_at":"1766171577030.0","metadata":"{\"bead_id\":\"thewodapp-e6o.2\",\"feature\":\"volunteer_signup\",\"pattern\":\"form_radio_buttons\"}"}
{"id":"d303185f-1933-4c68-b672-871256d7353d","information":"Fixed judge schedule page refactor to use server-side enriched data function. Key learnings:\n\n1. When worker creates server function with more parameters than original code, need to determine where to get those parameters (teamId from competition.competitionTeamId, empty array for divisionIds)\n\n2. Type definitions in server functions must match database schema exactly - commonColumns includes updateCounter field that must be present in manual type definitions\n\n3. Type compatibility requires matching LaneShiftPattern union type, not just string - import from volunteers schema\n\n4. Worker 2 created function with 5 params but task only mentioned 3 - pragmatic solution: pass sensible defaults (empty array for divisionIds) rather than blocking\n\n5. When manually defining rotation shape in EnrichedRotation type, must include all fields from CompetitionJudgeRotation including updateCounter","created_at":"1766163616646.0"}
{"id":"d36f6a47-c6b7-4e63-acb5-c4ea2de8777a","information":"WODsmith volunteer approval refactor: Updated updateVolunteerMetadataAction to handle both team invitations (tinv_*) and team memberships (tmem_*). Created approveVolunteerInvitation server function that sets invitedBy, updates invitation metadata to \"approved\", and creates teamMembership if user exists with that email. When approving an invitation, the function now properly sets the approver as invitedBy and sends approval email. This allows the new invitation-based volunteer signup flow to work seamlessly.","created_at":"1766119835553.0"}
{"id":"d519e9c8-4b6d-4b45-bcb0-87624204579b","information":"WODsmith judge schedule UI pattern: Enhanced ScheduleCard component to display enriched rotation data. Used Collapsible from shadcn for expandable details section. Display hierarchy: 1) Primary info grid (lane, heats, duration) with icons (MapPin, Target, Clock), 2) Expandable section with Tabs for division standards (multiple divisions), Event notes (amber background), and rotation-specific notes (blue background). Used opacity-60 for past rotations, border-primary/50 for upcoming. Passed full EnrichedRotation type from server module instead of flattened props.","created_at":"1766163911535.0"}
{"id":"d5d90fd0-14c3-43dc-8f03-96097e3dc4d6","information":"WODsmith schedule-utils.ts: TDD implementation of venue-aware heat scheduling utilities.\n\nKey patterns:\n1. **ScheduleHeat/ScheduleVenue interfaces** - Minimal interfaces matching CompetitionHeat/CompetitionVenue shapes but only requiring scheduling fields. Good for reusable utility functions that don't need full DB types.\n\n2. **Cross-event heat lookup** - Unlike heat-schedule-manager.tsx which filters by trackWorkoutId (current event only), schedule-utils works across ALL events. This is critical for venue conflict detection.\n\n3. **Date string normalization** - Use getLocalDateString() not toISOString().split('T')[0] for date comparisons. The latter uses UTC which causes timezone bugs (e.g., March 15 becoming March 14).\n\n4. **Overlap detection algorithm**: proposedStart < heatEnd AND heatStart < proposedEnd. Uses < (not <=) so exact boundaries don't count as overlap (end == start is allowed).\n\n5. **Test timezone handling** - Create dates with `new Date(year, month-1, day)` not `new Date(\"YYYY-MM-DD\")` to avoid UTC parsing issues in tests.\n\nFunctions:\n- getHeatEndTime(heat, venues, options) - Returns Date of when heat ends (scheduled + duration + transition)\n- getNextAvailableSlot(params) - Returns ISO string for next slot at venue on date\n- detectOverlaps(params) - Returns { hasOverlap, conflicts[] }\n\nConstants: DEFAULT_TRANSITION_MINUTES=3, DEFAULT_DURATION_MINUTES=15, DEFAULT_START_HOUR=8","created_at":"1766900720365.0"}
{"id":"d639c15f-8016-4d19-819c-aae4fbdeaae2","information":"Migrating test session mocks to createTestSession factory from @repo/test-utils/factories: The factory accepts options like userId, teamId, teamSlug, teamRole (e.g., 'owner', 'member'), and permissions array. Key session structure changes: session.teams[0].id for team ID, session.teams[0].role.id for role ID, session.teams[0].permissions is an array of permission strings. Factory auto-generates realistic defaults (createdAt, expiresAt, isCurrentSession, version: 5). Tests using TEAM_PERMISSIONS constants work seamlessly - just pass them in the permissions array. No changes needed to test logic, only to how sessions are created.","created_at":"1766271785102.0","tags":"testing,test-utils,factories,createTestSession,migration,wodsmith"}
{"id":"d6b6b745-a3aa-4196-b7f6-2f9adf4ceb33","information":"WodSmith competition list filtering tests: getCompetitions(teamId) filters by organizingTeamId using Drizzle ORM's eq() operator. Tests cover: (1) only team's competitions returned, (2) team switch returns different competitions, (3) empty array for team with no competitions, (4) includes organizingTeam/competitionTeam/group relations, (5) orders by startDate DESC. Key test pattern: when mocking drizzle-orm, use `vi.mock(\"drizzle-orm\", async (importOriginal) => { const actual = await importOriginal(); return { ...actual, eq: vi.fn() }})` to preserve the relations export which is required by schema files.","created_at":"1767209035064.0"}
{"id":"d6fa7540-949f-4ff2-96d4-72141f30b057","information":"Alchemy IaC - Drizzle + D1 Integration Pattern:\n\n1. **D1Database resource** with automatic migrations:\n```typescript\nimport { D1Database, Worker } from \"alchemy/cloudflare\";\n\nconst database = await D1Database(\"app-db\", {\n  name: \"app-db\",\n  migrationsDir: \"./migrations\", // Auto-applies migrations!\n});\n```\n\n2. **Bind to Worker**:\n```typescript\nexport const worker = await Worker(\"api-worker\", {\n  entrypoint: \"./src/worker.ts\",\n  bindings: {\n    DB: database,\n  },\n});\n```\n\n3. **Drizzle config** (`drizzle.config.ts`):\n```typescript\nimport { defineConfig } from 'drizzle-kit';\nexport default defineConfig({\n  schema: './src/schema.ts',\n  out: './migrations',\n  dialect: 'sqlite',\n});\n```\n\n4. **Generate migrations**: `bun drizzle-kit generate`\n\n5. **Use in Worker**:\n```typescript\nimport { drizzle } from 'drizzle-orm/d1';\nimport type { worker } from \"../alchemy.run.ts\";\n\ntype Env = typeof worker.Env;\n\nexport default {\n  async fetch(request: Request, env: Env) {\n    const db = drizzle(env.DB);\n    const users = await db.select().from(usersTable);\n    return Response.json({ users });\n  }\n};\n```\n\n**Key insight**: Alchemy auto-applies migrations from `migrationsDir` on deploy - no separate migration step needed. Migrations generated by drizzle-kit are applied automatically.","created_at":"1767043889749.0","tags":"alchemy,drizzle,d1,database,migrations,sqlite,cloudflare"}
{"id":"d8a13cfb-b8bc-463c-8e3b-051e1e73f141","information":"TanStack Start migration analysis pattern for route comparison: Use comprehensive markdown tables with columns: Route, Next.js Path, TanStack Path, Status (✅/🔄/❌), Actions/Functions, Components, Notes. Include executive summary at top with key findings and migration priorities. Document multi-tenancy patterns explicitly. Break analysis into: Routes, Actions/Functions, Components, Multi-Tenancy Patterns, Migration Gaps (High/Medium/Low priority with estimates), Technical Debt, Testing Considerations, File Inventory appendix. This structure helps identify what's migrated vs what's missing and provides actionable migration roadmap.","created_at":"1766529427107.0","tags":"tanstack-start,migration,documentation,analysis,multi-tenancy,route-comparison"}
{"id":"d8f7cbf5-f426-420c-afcb-b1bd9336ebd7","information":"WODsmith judge rotation admin UI implementation: All rotation UI components (rotation-overview.tsx, rotation-timeline.tsx, rotation-editor.tsx, rotation-block.tsx) were already created by mw8.2. Task mw8.3 integrated them into judge-scheduling-container.tsx with tabs for \"Manual Assignment\" vs \"Rotations\" views. Added rotations data fetching to page.tsx. Fixed critical server-side type errors: laneCount is a property of venue, not heat - needed to add leftJoin with competitionVenuesTable in both judge-rotations.ts validateRotationConflicts and judge-scheduling.ts getEventJudgeOverview. Also added missing updateCounter field when creating CompetitionJudgeRotation objects for expansion.","created_at":"1765994721866.0"}
{"id":"d98a29c2-2d9c-4591-9b86-e119dd115198","information":"blah","created_at":"1765564266613.0"}
{"id":"d9ed5ec3-6c7b-436e-b892-4bd0a2c474ff","information":"WODsmith TanStack migration route audit findings: Actual count is 39 routes total (7 settings, 28 admin split between explicit team ID and active team context patterns, 4 platform admin). Previous estimate of 19 routes was incomplete. Key architectural discovery: Next.js admin uses dual routing pattern where both /admin/teams/[teamId]/feature AND /admin/teams/feature coexist for same features. Active team routes use getAdminTeamContext() utility. Found undocumented Gym Scheduler AI section with 3 routes under /admin/teams/schedule. Missing action files now cataloged: generate-schedule-actions.ts, schedule-template-actions.ts, schedule-display-actions.ts, team-membership-actions.ts, team-role-actions.ts. TanStack Start verified to have only 3 route files in settings directory: settings.tsx layout, programming/index.tsx, programming/$trackId/index.tsx. Actual migration completion is 5 percent not 10 percent.","created_at":"1766530625345.0"}
{"id":"dad473b0-8cfb-433f-a7ca-9e969ab279e7","information":"WODsmith multi-tenancy programming subscription pattern: Users can belong to multiple teams. Each team can subscribe to public programming tracks independently. Key implementation: getPublicTracksWithTeamSubscriptions(teamIds[]) returns tracks with subscribedTeams[] showing which of user's teams are subscribed. UI shows badges for each subscribed team. Subscribe/unsubscribe actions are team-scoped (take teamId parameter). Track detail shows 'Your subscribed teams' section with badges. EnhancedSubscribeButton is team-aware. This allows single user to subscribe different teams to different tracks independently.","created_at":"1766529437140.0","tags":"wodsmith,multi-tenancy,programming-tracks,subscriptions,team-scoped-data"}
{"id":"dadc9725-aac7-457d-8b64-18d064b3c3ba","information":"Migrated team-specific-workout-resolution.test.ts from broken mock pattern to FakeDrizzleDb. Key learnings:\n\n1. The broken pattern: using .mockReturnThis() on individual mock methods doesn't work because it returns the mock function itself, not a chainable object.\n\n2. Solution: Import FakeDrizzleDb from @repo/test-utils which provides proper chainable mock implementation.\n\n3. Pattern for sequential query mocking: const whereMock = mockDb.getChainMock().where as any; then use whereMock.mockResolvedValueOnce([...]) for each sequential query result.\n\n4. Each test needs to call mockDb.reset() in beforeEach to clear state between tests.\n\n5. The FakeDrizzleDb handles the Drizzle query chain pattern correctly: select().from().where() all return chainable objects, and the final await resolves to the configured mock value.\n\n6. For functions that make multiple sequential queries (like getTeamSpecificWorkout which checks for remix then checks for original), you need to call mockResolvedValueOnce multiple times in sequence on the whereMock.\n\nFiles: apps/wodsmith/test/server/team-specific-workout-resolution.test.ts","created_at":"1766273125359.0","tags":"testing,drizzle,mocking,vitest,FakeDrizzleDb,chainable-mocks"}
{"id":"dcc08a48-0a28-4064-8c09-81be83baead2","information":"Vitest setup.ts pattern for Radix UI components: Add Element.prototype.scrollIntoView = vi.fn() to test/setup.ts to prevent errors when testing Radix UI components that use scrollIntoView (Dialog, Select, etc). This is a common requirement for headless UI component testing in jsdom environment. The mock needs to be at the top level of setup.ts, not inside describe blocks.","created_at":"1766272610967.0","tags":"vitest,testing,radix-ui,jsdom,scrollIntoView,setup,mocks"}
{"id":"de02fe0d-4dec-49b3-a272-fc1cead60340","information":"TanStack Start container component pattern for WODsmith migration: Server components use 'server-only' import and fetch data via server-fns (e.g., getVenuesForCompetitionFn). Pattern options: 1) Direct pass-through to child client component (simple case like VenueManagerContainer), 2) Render-prop pattern with children(data) for flexible rendering (complex case like ScheduleContainer fetching multiple data sources in parallel via Promise.all). Import paths use @/ NOT ~/. Server functions are in @/server-fns/ directory. Type exports like HeatWithAssignments and CompetitionWorkout come from server-fns files.","created_at":"1766700553835.0"}
{"id":"dfca448f-ded6-4625-9dc4-a75037fb16aa","information":"WODsmith volunteer invitations have inviteSource field in metadata: 'direct' (admin-invited, user accepts) or 'application' (user applied, admin approves). Legacy invitations may not have inviteSource but can be identified by invitedBy field. When filtering direct invites, check metadata.inviteSource === 'direct' OR invitation.invitedBy !== null for backward compatibility. Status calculation: acceptedAt set = 'accepted', expiresAt < now = 'expired', otherwise 'pending'.","created_at":"1766189097604.0","tags":"wodsmith,volunteers,invitations,inviteSource,direct,application,legacy-data,backward-compatibility"}
{"id":"e1ae0048-4aa2-44b2-922d-a0a1bae3eff6","information":"WODsmith judge rotation debugging: Added comprehensive error logging to judge-rotations.ts. Created getEnrichedRotationsForJudge() function that logs when trackWorkout, workout, or heats are missing. Logs include rotation IDs, trackWorkoutIds, and diagnostic counts. Function supports includeUnpublished option to filter by eventStatus='published'. Use this instead of manual enrichment in components for better diagnostics. Original getRotationsForJudge() now logs count of rotations found.","created_at":"1766162800856.0"}
{"id":"e21173b7-24fe-485c-b280-5edfeeef8b39","information":"WODsmith volunteer system: TeamMembership.metadata stores VolunteerMembershipMetadata JSON with volunteerRoleTypes array. Score access uses entitlements system with competition_score_input type. Helper functions parse metadata, check roles, and use autochunk for safe batch queries. Always use sql-batching for dynamic inArray queries to avoid D1's 999 parameter limit.","created_at":"1765950790297.0"}
{"id":"e436c597-164f-4cc0-a3d5-5c9c0195b41a","information":"WaiverViewer component testing pattern for react-markdown integration: When testing components that use react-markdown to render Lexical JSON as markdown, key patterns: 1) Test markdown elements using semantic queries (getByRole for headings/links, getByText for content), 2) Links rendered by custom components need attribute assertions (target, rel, className), 3) Mixed formatting (format: 3 = bold+italic) produces nested tags - test by checking both exist in hierarchy rather than exact nesting order (react-markdown may vary), 4) Empty content edge cases use container = render() to avoid multiple empty text node matches, 5) className prop tests check container.firstChild for root div classes.","created_at":"1766438026382.0","tags":"testing"}
{"id":"e5366145-0f90-4696-a4bd-b2c3c09f34ae","information":"Competition platform documentation patterns from Competition Corner: (1) Task-oriented naming matching user queries (How do I...), (2) Progressive complexity basic-to-advanced, (3) Error states get dedicated troubleshooting articles, (4) Complex features split into mix-match articles, (5) Concise under 500 words, (6) Applicability flags at top, (7) 5 Ws framework for setup, (8) Pro tip callouts. Strong correlation between article title and search success.","created_at":"1766354383806.0"}
{"id":"e5adbe51-4f79-4b01-860d-ae2c3ee41d8e","information":"Alchemy IaC TanStack Start Plugin Setup Issue:\n\n1. **Import Issue**: The plugin uses a DEFAULT export, not named export.\n   - WRONG: `import { alchemy } from \"alchemy/cloudflare/tanstack-start\"`\n   - RIGHT: `import alchemy from \"alchemy/cloudflare/tanstack-start\"`\n\n2. **Configuration Requirement**: Alchemy requires a configured Cloudflare profile before use.\n   - Run `bun alchemy configure` interactively to set up OAuth\n   - Or set `CLOUDFLARE_API_TOKEN` and `CLOUDFLARE_ACCOUNT_ID` environment variables\n   \n3. **Startup Sequence**:\n   - First run `STAGE=dev bun alchemy.run.ts` to generate `.alchemy/local/wrangler.jsonc`\n   - Then `pnpm dev` will work\n\n4. **Error signatures**:\n   - \"does not provide an export named 'alchemy'\" → Use default import\n   - \"Provider 'cloudflare' not found in profile\" → Run `alchemy configure`\n   - \"wrangler.jsonc could not be found\" → Run alchemy to generate it","created_at":"1767046428841.0"}
{"id":"e86c4344-253a-4b4b-9a2f-7f70df14e61f","information":"TanStack Start auth migration audit completed for WODsmith. Found 8 Next.js auth routes (not 7): sign-in, sign-up, forgot-password, reset-password, verify-email, sso/google (initiation), sso/google/callback, and team-invite. All 10 actions are documented correctly. TanStack sign-up.tsx DOES use canSignUp for disposable email checking (line 51) - was incorrectly documented as missing. Only 2 routes migrated so far (sign-in, sign-up), making it 25% complete (2/8). Common mistake: counting OAuth flow as one route when it's actually two separate route files.","created_at":"1766530428635.0"}
{"id":"e95ef695-489e-4572-9abc-002c4266205c","information":"Created TeamMembership factory for WODsmith test-utils following established patterns. Factory supports: id (tmem_ prefix), teamId, userId, roleId (default: \"member\"), isSystemRole, metadata (JSON string for volunteer data), isActive, joinedAt, timestamps. Added helper createVolunteerMembership() for volunteer-specific memberships with typed VolunteerMetadata interface (volunteerRoleTypes, availability, credentials, availabilityNotes). Pattern matches other factories (user.ts, team.ts) - uses createId() from @paralleldrive/cuid2, provides sensible defaults, accepts Partial overrides. Exported from @repo/test-utils/factories index.","created_at":"1766272582452.0"}
{"id":"edea70c5-61eb-44a5-aca9-36c704846238","information":"## WODsmith Competition Organizer Workflow Catalog\n\n### WORKFLOW 1: Create Competition\n**Route Path:** `/compete/organizer/new`\n**Server Functions:** `createCompetitionFn`, `getCompetitionGroupsFn`\n**Key User Actions:**\n- Enter competition name and generate unique slug\n- Set competition dates (start/end)\n- Configure registration window (opens/closes)\n- Optionally assign to a competition series/group\n- Select organizing team\n\n**Decision Points:**\n- Is this a standalone competition or part of a series?\n- When should registration open?\n- Should this be public or draft?\n\n**Diataxis Mapping:** \n- TUTORIAL: \"Create your first competition\" - learning experience for new organizers\n- HOW-TO: \"Set up a competition series\" - task completion for experienced organizers\n\n---\n\n### WORKFLOW 2: Configure Divisions\n**Route Path:** `/compete/organizer/$competitionId/divisions`\n**Server Functions:** `getCompetitionDivisionsWithCountsFn`, `listScalingGroupsFn`\n**Key User Actions:**\n- Select scaling group (predefined division templates)\n- Add/edit individual divisions\n- Configure team sizes per division\n- Set division-specific details\n\n**Decision Points:**\n- Use predefined scaling groups or custom divisions?\n- Individual vs team divisions?\n- Division capacity limits?\n\n**Diataxis Mapping:**\n- HOW-TO: \"Configure competition divisions\" - task-focused\n- REFERENCE: \"Division settings and team sizes\" - technical details\n\n---\n\n### WORKFLOW 3: Add Events (Workouts)\n**Route Path:** `/compete/organizer/$competitionId/events/`\n**Server Functions:** `getCompetitionWorkoutsFn`, `getAllMovementsFn`, `getCompetitionSponsorsFn`, `getWorkoutDivisionDescriptionsFn`\n**Key User Actions:**\n- Create/add events to competition\n- Configure workout details (scheme, scoring type, time cap)\n- Assign division-specific descriptions\n- Link sponsors to events\n- Reorder events (track order)\n\n**Decision Points:**\n- Workout scoring scheme (For Time, AMRAP, etc.)\n- Division-specific scaling?\n- Event sponsorship assignments?\n\n**Diataxis Mapping:**\n- TUTORIAL: \"Add your first event\" - new organizer learning\n- HOW-TO: \"Configure division-specific event scaling\" - task completion\n- REFERENCE: \"Scoring schemes and workout types\" - technical reference\n\n---\n\n### WORKFLOW 4: Schedule Heats\n**Route Path:** `/compete/organizer/$competitionId/schedule`\n**Server Functions:** `getCompetitionVenuesFn`, `getHeatsForCompetitionFn`, `getCompetitionRegistrationsFn`\n**Key User Actions:**\n- Create venues with lane counts\n- Generate heats per event/division\n- Set heat times and durations\n- Assign athletes to lanes/heats\n- Manage heat schedule timeline\n\n**Decision Points:**\n- How many lanes per venue?\n- Heat duration and transition time?\n- Automatic vs manual athlete assignment?\n- Multi-day schedule considerations?\n\n**Diataxis Mapping:**\n- TUTORIAL: \"Schedule your competition day\" - critical learning for new organizers\n- HOW-TO: \"Manage multi-venue heat schedules\" - advanced task\n- EXPLANATION: \"How heat generation works\" - background concepts\n\n---\n\n### WORKFLOW 5: Manage Athlete Registrations\n**Route Path:** `/compete/organizer/$competitionId/athletes`\n**Server Functions:** `getOrganizerRegistrationsFn`, `getCompetitionDivisionsWithCountsFn`\n**Key User Actions:**\n- View all registrations with filtering by division\n- See athlete/team details (captain, teammates)\n- Track pending team invitations\n- Monitor registration counts per division\n\n**Decision Points:**\n- Division assignment corrections?\n- Waitlist management?\n- Refund/cancellation handling?\n\n**Diataxis Mapping:**\n- HOW-TO: \"Review and manage athlete registrations\" - task-focused\n- REFERENCE: \"Registration statuses and team structures\" - technical reference\n\n---\n\n### WORKFLOW 6: Configure Pricing\n**Route Path:** `/compete/organizer/$competitionId/pricing`\n**Server Functions:** `getStripeConnectionStatusFn`, `getCompetitionDivisionFeesFn`, `getScalingGroupWithLevelsFn`\n**Key User Actions:**\n- Connect Stripe account (required first)\n- Set default registration fee\n- Configure division-specific pricing\n- Set fee pass-through options (platform fees, Stripe fees)\n\n**Decision Points:**\n- Pass fees to customer or absorb?\n- Different pricing per division?\n- Early bird vs regular pricing?\n\n**Diataxis Mapping:**\n- TUTORIAL: \"Set up paid registration\" - critical for monetization\n- HOW-TO: \"Configure division-specific pricing\" - task completion\n- REFERENCE: \"Fee calculation and Stripe integration\" - technical details\n\n---\n\n### WORKFLOW 7: Manage Volunteers and Judges\n**Route Path:** `/compete/organizer/$competitionId/volunteers`\n**Server Functions:** `getCompetitionVolunteersFn`, `getJudgeVolunteersFn`, `getPendingVolunteerInvitationsFn`, `getDirectVolunteerInvitesFn`\n**Key User Actions:**\n- Invite volunteers (direct invite or application)\n- Approve/deny volunteer applications\n- Assign volunteer roles (judge, scorekeeper, etc.)\n- Grant score input permissions\n- Manage credential badges\n\n**Decision Points:**\n- Application vs direct invite workflow?\n- Which volunteers can input scores?\n- Volunteer role assignments?\n\n**Diataxis Mapping:**\n- HOW-TO: \"Invite and manage volunteers\" - task-focused\n- HOW-TO: \"Grant score input permissions\" - specific task\n\n---\n\n### WORKFLOW 8: Schedule Judge Rotations (Complex)\n**Route Path:** `/compete/organizer/$competitionId/volunteers` (JudgeSchedulingContainer)\n**Server Functions:** `getJudgeHeatAssignmentsFn`, `getRotationsForEventFn`, `getActiveVersionFn`, `getVersionHistoryFn`, `rollbackToVersionFn`\n**Key User Actions:**\n- Create judge rotations per event\n- Configure rotation defaults (heats per rotation, lane shift pattern)\n- Assign judges to specific lanes/heats\n- Publish rotation versions\n- Rollback to previous versions\n- View rotation timeline and coverage\n\n**Decision Points:**\n- Stay vs shift right lane pattern?\n- Heats per rotation?\n- Manual vs automatic judge assignment?\n- Which version to publish?\n\n**Diataxis Mapping:**\n- TUTORIAL: \"Schedule judge rotations\" - complex learning experience\n- HOW-TO: \"Configure rotation patterns\" - task completion\n- EXPLANATION: \"How judge rotation works\" - background concepts (lane shift, coverage)\n- REFERENCE: \"Version history and rollback\" - technical details\n\n---\n\n### WORKFLOW 9: Enter Competition Results\n**Route Path:** `/compete/organizer/$competitionId/results`\n**Server Functions:** `getEventScoreEntryDataWithHeatsFn`, `saveCompetitionScoreFn`\n**Key User Actions:**\n- Select event and division to score\n- Enter athlete scores (time, reps, weight)\n- Set score status (scored, cap, DNF, DNS, DQ)\n- Handle tiebreaker scores\n- View scores by heat\n\n**Decision Points:**\n- Score entry by heat vs all at once?\n- Tiebreaker handling?\n- Score validation?\n\n**Diataxis Mapping:**\n- TUTORIAL: \"Enter competition scores\" - essential event day skill\n- HOW-TO: \"Handle DNF, DNS, and DQ entries\" - specific task\n- REFERENCE: \"Score types and tiebreaker schemes\" - technical reference\n\n---\n\n### WORKFLOW 10: Track Revenue\n**Route Path:** `/compete/organizer/$competitionId/revenue`\n**Server Functions:** `getCompetitionRevenueStatsFn`, `getOrganizerStripeStatusFn`\n\n---\n\n### WORKFLOW 11: Manage Sponsors\n**Route Path:** `/compete/organizer/$competitionId/sponsors`\n\n---\n\n### WORKFLOW 12: Manage Competition Series\n**Route Path:** `/compete/organizer/series/`\n\n---\n\n### WORKFLOW 13: Edit Competition Details\n**Route Path:** `/compete/organizer/$competitionId/edit`\n\n---\n\n### WORKFLOW 14: Competition Settings\n**Route Path:** `/compete/organizer/$competitionId/settings`\n\n---\n\n### WORKFLOW 15: Delete Competition (Danger Zone)\n**Route Path:** `/compete/organizer/$competitionId/danger-zone`","created_at":"1767131466190.0"}
{"id":"ef321ab9-a0a7-4c28-829b-b37287008e22","information":"WODsmith waiver signing integration: Implemented multi-step registration form with waiver signing before payment. Key pattern: Don't sign waivers on checkbox change (async UX issue) - instead, track checked state and sign all waivers when user clicks Continue. WaiverSigningStep component accepts signedWaiverIds Set to pre-check already-signed waivers. Registration form uses step state to conditionally render steps.","created_at":"1766383015032.0","tags":"wodsmith,waivers,multi-step-form"}
{"id":"f0e1f7e0-42b5-419f-9d3e-7dacbbfc39fb","information":"Competition Corner Integrations and API documentation analysis reveals key patterns: (1) Hardware integration docs (Minos device) excel at workflow-based structure mirroring real-time event flow, with embedded troubleshooting and safety nets (paper backups). (2) API integration docs gate complexity with prerequisites, explicit data format specs (HH:MM:SS.000), video walkthroughs, and TEST TEST TEST emphasis. (3) White-labeling docs intentionally sparse - beta gating forces sales contact, no self-serve. MAJOR GAPS: No full API reference (endpoints, auth, errors), no SDKs/code samples, no developer sandbox, no integration marketplace, no transparent pricing for white-labeling. OPPORTUNITY: New platform should lead with developer-first approach - OpenAPI spec, interactive docs, multi-language SDKs, sandbox environment, transparent pricing, integration marketplace. Competition Corner contact-us gating creates friction; self-serve wins.","created_at":"1766354497874.0","tags":"documentation-analysis,competition-corner,integrations,API,white-labeling,developer-experience,competitor-research"}
{"id":"f1df1056-7fb5-4916-836f-07f5a1ffc279","information":"## Athlete Documentation Diataxis Mapping\n\n### TUTORIALS (Learning-oriented, first-time experience)\n\n1. **First Competition Registration Tutorial**\n   - Target: Athletes who have never registered for a WODsmith competition\n   - Journey: Create account → Find competition → Understand divisions → Register → Complete profile\n   - Routes: `/compete/$slug` → `/compete/$slug/register` → `/compete/$slug/register/success`\n   - Outcome: Successfully registered with complete athlete profile\n\n2. **Team Registration Tutorial**\n   - Target: Team captains registering their team\n   - Journey: Register as captain → Select team division → Enter team name → Invite teammates\n   - Key concepts: Team invitations, captain responsibilities, teammate acceptance flow\n\n3. **Volunteer Signup Tutorial**\n   - Target: First-time volunteers\n   - Journey: Find competition → Volunteer page → Submit application → Wait for approval\n   - Route: `/compete/$slug/volunteer`\n   - Outcome: Application submitted, understand approval process\n\n### HOW-TO GUIDES (Task-oriented, returning athletes)\n\n1. **How to find your heat time**\n   - Problem: Need to know when you compete\n   - Steps: Navigate to competition → Schedule tab → Find your name/division\n   - Route: `/compete/$slug/schedule`\n\n2. **How to check your leaderboard standing**\n   - Problem: Want to see current rankings\n   - Steps: Competition page → Leaderboard tab → Filter by division\n   - Route: `/compete/$slug/leaderboard`\n\n3. **How to review workout standards**\n   - Problem: Need to prepare for specific movements\n   - Steps: Competition page → Workouts tab → Select division for standards\n   - Route: `/compete/$slug/workouts`\n\n4. **How to share team invite links (Captain)**\n   - Problem: Need teammates to join\n   - Steps: After registration success → Copy invite links → Share with teammates\n   - Route: `/compete/$slug/register/success`\n\n5. **How to view and update your volunteer profile**\n   - Problem: Need to change availability or credentials\n   - Steps: My Schedule page → Edit button on profile card → Update and save\n   - Route: `/compete/$slug/my-schedule`\n\n6. **How to view your judging assignments**\n   - Problem: Judge needs to know where to be and when\n   - Steps: My Schedule page → Review event sections → Check rotation cards\n   - Route: `/compete/$slug/my-schedule`\n\n### REFERENCE (Information-oriented, technical details)\n\n1. **Scoring Schemes Reference**\n   - For Time, Time with Cap, Rounds+Reps, Reps, EMOM, Load, Pass/Fail\n   - Tiebreak handling, rounds to score, points multipliers\n\n2. **Volunteer Role Types**\n   - judge, head_judge, scorekeeper, emcee, floor_manager, media, general, equipment, medical, check_in, staff\n\n3. **Registration Status States**\n   - Registration open, closed, not yet open\n   - Capacity limits and waitlist behavior\n\n4. **Division/Scaling System**\n   - Scaling groups → Scaling levels\n   - Per-division workout descriptions\n   - Per-division pricing\n\n### EXPLANATION (Understanding-oriented, background concepts)\n\n1. **How Heats and Rotations Work**\n   - What is a heat? Groups of athletes competing at the same time\n   - What are lanes? Physical positions within a heat\n   - Rotation scheduling for judges\n\n2. **Understanding Competition Divisions**\n   - Why divisions exist (Rx, Scaled, Masters, etc.)\n   - How division affects workouts and scoring\n   - Team vs Individual divisions\n\n3. **The Volunteer Approval Process**\n   - Public application → Pending status → Organizer review → Approved\n   - How invitation/membership system works\n   - Difference between application and direct invite\n\n4. **How Competition Scoring Works**\n   - Points multipliers per event\n   - Tiebreak scenarios\n   - Leaderboard calculation","created_at":"1767131461084.0"}
{"id":"f2662dbc-3445-43b8-b69e-47086e4ed107","information":"WODsmith volunteer availability field: Added VOLUNTEER_AVAILABILITY const with MORNING/AFTERNOON/ALL_DAY values and VolunteerAvailability type to volunteers.ts schema. This allows filtering judges by availability when assigning to heats (morning judges shouldn't be assigned to afternoon heats). Field is optional in VolunteerMembershipMetadata interface. Pattern follows existing VOLUNTEER_ROLE_TYPES and LANE_SHIFT_PATTERN consts.","created_at":"1766171112431.0"}
{"id":"f2afc2f6-947e-45ff-8adb-1a06bd283b58","information":"WODsmith MultiRotationEditor pattern: Successfully created accordion-style multi-rotation editor using react-hook-form useFieldArray, Collapsible from shadcn, and batch actions. Key patterns: 1) Single judge selector outside accordion for all rotations, 2) useFieldArray for dynamic rotation blocks, 3) Collapsible with controlled open state, 4) Active block tracking with ring-2 ring-primary highlight, 5) Preview cells extended with blockIndex for grid rendering, 6) External position updates targeting active block only, 7) Auto-open new blocks when appended, 8) Adjust active index when blocks removed, 9) Button as CollapsibleTrigger (not div) for accessibility, 10) Batch create/update actions for atomic operations.","created_at":"1766080863182.0"}
{"id":"f2e0a116-ae6b-4f8b-bdfa-1e3ec9cd79be","information":"## Athlete Workflows in WODsmith Competition Platform\n\n### WORKFLOW CATALOG\n\n#### 1. Discover Competition\n- **Route**: `/compete/$slug` (index.tsx)\n- **Server Functions**: `getCompetitionBySlugFn`, `getCompetitionRegistrationCountFn`, `getRegistrationStatusFn`, `getUserCompetitionRegistrationFn`, `checkIsVolunteerFn`\n- **Key User Actions**:\n  - View competition hero (name, dates, location, banner image)\n  - Check registration status (open/closed/not yet open)\n  - See current registration count\n  - View overview with placeholder workout and schedule info\n- **Decision Points**: Register now vs wait, view more details (workouts, schedule)\n\n#### 2. Register for Competition\n- **Routes**: `/compete/$slug/register`, `/compete/$slug/register/success`\n- **Server Functions**: \n  - `initiateRegistrationPaymentFn` (handles FREE + PAID registrations)\n  - `getRegistrationFeeBreakdownFn`\n  - `getUserCompetitionRegistrationFn`\n  - `getScalingGroupWithLevelsFn` (for division selection)\n- **Key User Actions**:\n  - Select division from scaling group\n  - Enter affiliate name, team name (for team divisions)\n  - Add teammate emails (team registrations)\n  - Complete payment (Stripe Checkout for paid, instant for free)\n  - View payment receipt\n  - Complete athlete profile (gender, DOB, affiliate) post-registration\n  - Share team invite links (team captain)\n- **Decision Points**: Division selection, payment method\n- **Validation**: Authentication required, registration window check, duplicate registration check, profile completeness prompt\n\n#### 3. View Workouts\n- **Route**: `/compete/$slug/workouts`\n- **Server Functions**: \n  - `getPublishedCompetitionWorkoutsFn`\n  - `getWorkoutDivisionDescriptionsFn`\n  - `getPublicCompetitionDivisionsFn`\n- **Key User Actions**:\n  - Browse announced workouts (event name, scheme, description)\n  - View division-specific workout descriptions\n  - See scoring details (time cap, rounds to score, points multiplier)\n\n#### 4. View Competition Schedule\n- **Route**: `/compete/$slug/schedule`\n- **Server Functions**: `getHeatsForCompetitionFn`, `getPublishedCompetitionWorkoutsFn`\n- **Key User Actions**:\n  - View heat schedule by event\n  - Find their heat assignment (if registered)\n  - See timing for each heat\n\n#### 5. Track Leaderboard\n- **Route**: `/compete/$slug/leaderboard`\n- **Components**: `LeaderboardPageContent`\n- **Key User Actions**:\n  - View overall standings by division\n  - See event-by-event results\n  - Track their own ranking\n\n#### 6. View Personal Schedule (Volunteer/Judge)\n- **Route**: `/compete/$slug/my-schedule`\n- **Server Functions**: `getVolunteerMembershipFn`, `getVolunteerScheduleDataFn`\n- **Key User Actions**:\n  - View assigned judging rotations per event\n  - Select division to see workout standards\n  - Edit volunteer profile (availability, credentials)\n  - See rotation cards with heat assignments\n- **Auth Required**: Yes\n\n#### 7. Volunteer Signup\n- **Route**: `/compete/$slug/volunteer`\n- **Server Functions**: `submitVolunteerSignupFn`\n- **Key User Actions**:\n  - Submit volunteer application (name, email, phone, credentials)\n  - Select availability (morning, afternoon, all day)\n  - Add availability notes\n- **Auth**: NOT required (public form)","created_at":"1767131435161.0"}
{"id":"f59e44d8-0351-4f54-8820-981347a176ce","information":"When running `pnpm drizzle-kit generate --name <migration-name>` in WODsmith, the CLI may prompt interactively asking about table changes (e.g., \"Is table created or renamed?\"). Use `expect` to automate responses:\n\n```bash\nexpect -c '\nset timeout 30\nspawn pnpm drizzle-kit generate --name migration-name\nexpect {\n    \"created or renamed\" {\n        send \"\\r\"\n        exp_continue\n    }\n    \"Migration\" {\n        exp_continue\n    }\n    eof\n}\n' 2>&1\n```\n\nThis sends Enter (\\r) to select the default option and continues until the command completes.","created_at":"1766119074800.0","metadata":"{\"task\":\"drizzle-migration\",\"tool\":\"expect\",\"context\":\"interactive-cli\"}"}
{"id":"f5a512b4-d09e-4cbb-8096-385df9a8a9ff","information":"Competition Corner online/virtual competition documentation analysis reveals effective patterns: (1) Step-by-step task guides with action-oriented titles matching user intent, (2) Inline Quick Tip callouts for time-savers and common mistakes, (3) Comprehensive automation features (workout announcements, deadline reminders), (4) Sophisticated tiebreaker system (AMRAP time, max rep, time cap rep variants), (5) Judge score validation and community video review for integrity. Key gaps: integration documentation weak, judge coordination workflows missing, anti-cheating strategies not documented, multi-stage event complexity not covered. Unique opportunities for new platform: AI-powered score anomaly detection, progressive complexity hiding, analytics-driven insights, judge/volunteer management tools, adaptive athlete-first design.","created_at":"1766354483768.0"}
{"id":"f5ae1ed5-1aaa-4e05-830f-9bf414718f47","information":"WODsmith waiver server testing: Mock db.query API with vi.fn().mockResolvedValue(). Mock autochunk to call fn with all items. Pattern in waivers.test.ts passes 22 tests.","created_at":"1766440989019.0","tags":"testing"}
{"id":"f6433aec-55fb-466e-9d41-8d93577c72a8","information":"Skill modular workflow pattern: When skills have large workflow reference files (>400 lines), split them into focused reference files by workflow group (<150 lines each). SKILL.md should stay under 100 lines with a lazy-load routing table that tells Claude WHEN to load each reference. Pattern used successfully for competition-organizer-docs (817 lines → 5 files) and athlete-docs (479 lines → 4 files). Key: group by user journey/workflow type, not by documentation type. Each reference file is self-contained with routes, components, user actions, and documentation requirements.","created_at":"1767132409718.0"}
{"id":"f6860aac-1248-4f15-b8b4-ef6b97ff0cbe","information":"WODsmith batch rotation server actions implementation: Added `batchCreateRotationsAction` and `batchUpdateVolunteerRotationsAction` for creating/updating multiple judge rotations at once. Key patterns: 1) Validate ALL rotations before creating any (fail-fast), 2) Check conflicts between new rotations themselves (overlapping heat ranges), 3) Use Promise.all for parallel validation, 4) Sequential creation since D1 doesn't support transactions, 5) For batch update: delete existing rotations first, then create new ones, 6) Return both rotationIds array and full rotation objects. Both actions use same laneShiftPattern for all rotations in the batch, accept array of rotation blocks with startingHeat/startingLane/heatsCount/notes.","created_at":"1766080614344.0"}
{"id":"f82444c4-74cf-4893-8ff0-ab0dd84e658f","information":"TanStack Start server function migration from Next.js ZSA: Key adaptations made:\n1. Replace createServerAction() with createServerFn({method: 'GET'|'POST'})\n2. Replace .input(schema) with .inputValidator((data: unknown) => schema.parse(data))\n3. Replace .handler(async ({input}) => ...) with .handler(async ({data}) => ...)\n4. Auth: Use getSessionFromCookie() and requireVerifiedEmail() from @/utils/auth (same as Next.js version)\n5. Cookies: Use setCookie from @tanstack/react-start/server instead of Next.js cookies()\n6. Rate limiting: Not ported - TanStack Start doesn't have withRateLimit equivalent yet\n7. Helper functions (hasTeamPermission, requireTeamPermission, requireTeamMembership) are defined locally in each file\n8. For Stripe Connect OAuth, CSRF state is stored in cookie with maxAge in seconds (not ms string)\n9. Export functions/types that will be used by API routes (like parseOAuthState, handleOAuthCallback)","created_at":"1766643820954.0"}
{"id":"fa783231-a0ab-4b59-ba27-491bd80d5607","information":"--information","created_at":"1766271744366.0","tags":"testing,factories,session,migration"}
{"id":"fd379e9d-fefa-43a4-b68b-bceaefe46393","information":"Created GitHub Actions E2E workflow for Playwright with sharding (2 shards). Key pattern: split e2e job into matrix strategy (shardIndex, shardTotal), each shard uploads blob-report artifact, merge-reports job downloads all artifacts and merges into single HTML report. Critical: merge-reports must use 'if: always()' to run even if e2e job fails, and artifact download must use 'merge-multiple: true' to combine blob-report-1 and blob-report-2. Playwright blob reporter enables efficient sharding without duplicate HTML generation during test runs.","created_at":"1766269963786.0"}
{"id":"fedff4d7-7f29-40bc-8ada-25535753ee3f","information":"Created FakeDrizzleDb mock wrapper for Drizzle ORM testing in @repo/test-utils. Key implementation details:\n\n1. **Chainable API**: All query methods (select, from, where, join, etc.) return the mock itself for chaining\n2. **Thenable at any point**: Mock has a `then` method so `await` works at any point in the chain, not just terminal methods\n3. **Configurable per-test**: setMockReturnValue(), setMockSingleValue(), setMockChanges() allow customizing behavior\n4. **Query API support**: registerTable() enables db.query.tableName.findFirst() pattern\n5. **Vitest Mock type**: Use `Mock<T>` with function signature, not `Mock<TArgs[], TReturn>` (vitest's type changed)\n6. **All methods are vi.fn()**: Enables verification with toHaveBeenCalled(), toHaveBeenCalledWith()\n\nThe mock wraps createChainableMock pattern from apps/wodsmith/test/setup.ts but makes it reusable and type-safe. Tests verify: chainability, thenability, mutations (insert/update/delete), query API, spy verification.\n\nCritical pattern: Each method returns the mock itself, except terminal methods (returning(), get(), all(), run()) which return promises.","created_at":"1766272790931.0","tags":"testing,drizzle,mock,test-utils,vitest"}